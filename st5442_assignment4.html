
<!DOCTYPE html>
<HTML>
<HEAD>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/LaTeX", "output/HTML-CSS"],
    "HTML-CSS": { availableFonts: ["TeX"] }
    });
</script>

<script type="text/javascript"
    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<style>

@font-face {
  font-family: 'Raleway';
  font-style: normal;
  font-weight: 300;
  src: local('Raleway Light'), local('Raleway-Light'), url(http://fonts.gstatic.com/s/raleway/v9/-_Ctzj9b56b8RgXW8FArifk_vArhqVIZ0nv9q090hN8.woff2) format('woff2');
}
@font-face {
  font-family: 'Raleway';
  font-style: normal;
  font-weight: 400;
  src: local('Raleway'), url(http://fonts.gstatic.com/s/raleway/v9/0dTEPzkLWceF7z0koJaX1A.woff2) format('woff2');
}
@font-face {
  font-family: 'Raleway';
  font-style: normal;
  font-weight: 600;
  src: local('Raleway SemiBold'), local('Raleway-SemiBold'), url(http://fonts.gstatic.com/s/raleway/v9/xkvoNo9fC8O2RDydKj12b_k_vArhqVIZ0nv9q090hN8.woff2) format('woff2');
}
html {
  font-family: sans-serif; /* 1 */
  -ms-text-size-adjust: 100%; /* 2 */
  -webkit-text-size-adjust: 100%; /* 2 */
}
body {
  margin: 0;
}
article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
menu,
nav,
section,
summary {
  display: block;
}
audio,
canvas,
progress,
video {
  display: inline-block; /* 1 */
  vertical-align: baseline; /* 2 */
}
audio:not([controls]) {
  display: none;
  height: 0;
}
[hidden],
template {
  display: none;
}
a:active,
a:hover {
  outline: 0;
}
abbr[title] {
  border-bottom: 1px dotted;
}
b,
strong {
  font-weight: bold;
}
dfn {
  font-style: italic;
}
h1 {
  font-size: 2em;
  margin: 0.67em 0;
}
mark {
  background: #ff0;
  color: #000;
}
small {
  font-size: 80%;
}
sub,
sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}
sup {
  top: -0.5em;
}
sub {
  bottom: -0.25em;
}
img {
  border: 0;
}
svg:not(:root) {
  overflow: hidden;
}
figure {
  margin: 1em 40px;
}
hr {
  -moz-box-sizing: content-box;
  box-sizing: content-box;
  height: 0;
}
pre {
  overflow: auto;
}
code,
kbd,
pre,
samp {
  font-family: monospace, monospace;
  font-size: 1em;
}
button,
input,
optgroup,
select,
textarea {
  color: inherit; /* 1 */
  font: inherit; /* 2 */
  margin: 0; /* 3 */
}
button {
  overflow: visible;
}
button,
select {
  text-transform: none;
}
button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
  -webkit-appearance: button; /* 2 */
  cursor: pointer; /* 3 */
}
button[disabled],
html input[disabled] {
  cursor: default;
}
button::-moz-focus-inner,
input::-moz-focus-inner {
  border: 0;
  padding: 0;
}
input {
  line-height: normal;
}
input[type="checkbox"],
input[type="radio"] {
  box-sizing: border-box; /* 1 */
  padding: 0; /* 2 */
}
input[type="number"]::-webkit-inner-spin-button,
input[type="number"]::-webkit-outer-spin-button {
  height: auto;
}
input[type="search"] {
  -webkit-appearance: textfield; /* 1 */
  -moz-box-sizing: content-box;
  -webkit-box-sizing: content-box; /* 2 */
  box-sizing: content-box;
}
input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
  -webkit-appearance: none;
}
fieldset {
  border: 1px solid #c0c0c0;
  margin: 0 2px;
  padding: 0.35em 0.625em 0.75em;
}
legend {
  border: 0; /* 1 */
  padding: 0; /* 2 */
}
textarea {
  overflow: auto;
}
optgroup {
  font-weight: bold;
}
table {
  border-collapse: collapse;
  border-spacing: 0;
}
td,
th {
  padding: 0;
}


/*
* Skeleton V2.0.4
* Copyright 2014, Dave Gamache
* www.getskeleton.com
* Free to use under the MIT license.
* http://www.opensource.org/licenses/mit-license.php
* 12/29/2014
*/
.container {
  position: relative;
  width: 100%;
  max-width: 960px;
  margin: 0 auto;
  padding: 0 20px;
  box-sizing: border-box; }
.column,
.columns {
  width: 100%;
  float: left;
  box-sizing: border-box; }
@media (min-width: 400px) {
  .container {
    width: 85%;
    padding: 0; }
}
@media (min-width: 550px) {
  .container {
    width: 80%; }
  .column,
  .columns {
    margin-left: 4%; }
  .column:first-child,
  .columns:first-child {
    margin-left: 0; }

  .one.column,
  .one.columns                    { width: 4.66666666667%; }
  .two.columns                    { width: 13.3333333333%; }
  .three.columns                  { width: 22%;            }
  .four.columns                   { width: 30.6666666667%; }
  .five.columns                   { width: 39.3333333333%; }
  .six.columns                    { width: 48%;            }
  .seven.columns                  { width: 56.6666666667%; }
  .eight.columns                  { width: 65.3333333333%; }
  .nine.columns                   { width: 74.0%;          }
  .ten.columns                    { width: 82.6666666667%; }
  .eleven.columns                 { width: 91.3333333333%; }
  .twelve.columns                 { width: 100%; margin-left: 0; }

  .one-third.column               { width: 30.6666666667%; }
  .two-thirds.column              { width: 65.3333333333%; }

  .one-half.column                { width: 48%; }

  /* Offsets */
  .offset-by-one.column,
  .offset-by-one.columns          { margin-left: 8.66666666667%; }
  .offset-by-two.column,
  .offset-by-two.columns          { margin-left: 17.3333333333%; }
  .offset-by-three.column,
  .offset-by-three.columns        { margin-left: 26%;            }
  .offset-by-four.column,
  .offset-by-four.columns         { margin-left: 34.6666666667%; }
  .offset-by-five.column,
  .offset-by-five.columns         { margin-left: 43.3333333333%; }
  .offset-by-six.column,
  .offset-by-six.columns          { margin-left: 52%;            }
  .offset-by-seven.column,
  .offset-by-seven.columns        { margin-left: 60.6666666667%; }
  .offset-by-eight.column,
  .offset-by-eight.columns        { margin-left: 69.3333333333%; }
  .offset-by-nine.column,
  .offset-by-nine.columns         { margin-left: 78.0%;          }
  .offset-by-ten.column,
  .offset-by-ten.columns          { margin-left: 86.6666666667%; }
  .offset-by-eleven.column,
  .offset-by-eleven.columns       { margin-left: 95.3333333333%; }

  .offset-by-one-third.column,
  .offset-by-one-third.columns    { margin-left: 34.6666666667%; }
  .offset-by-two-thirds.column,
  .offset-by-two-thirds.columns   { margin-left: 69.3333333333%; }

  .offset-by-one-half.column,
  .offset-by-one-half.columns     { margin-left: 52%; }

}
html {
  font-size: 62.5%; }
body {
  font-size: 1.5em; /* currently ems cause chrome bug misinterpreting rems on body element */
  line-height: 1.6;
  font-weight: 400;
  font-family: "Raleway", "HelveticaNeue", "Helvetica Neue", Helvetica, Arial, sans-serif;
  color: #222; }
h1, h2, h3, h4, h5, h6 {
  margin-top: 0;
  margin-bottom: 2rem;
  font-weight: 300; }
h1 { font-size: 3.6rem; line-height: 1.2;  letter-spacing: -.1rem;}
h2 { font-size: 3.4rem; line-height: 1.25; letter-spacing: -.1rem; }
h3 { font-size: 3.2rem; line-height: 1.3;  letter-spacing: -.1rem; }
h4 { font-size: 2.8rem; line-height: 1.35; letter-spacing: -.08rem; }
h5 { font-size: 2.4rem; line-height: 1.5;  letter-spacing: -.05rem; }
h6 { font-size: 1.5rem; line-height: 1.6;  letter-spacing: 0; }

p {
  margin-top: 0; }
a {
  color: #1EAEDB; }
a:hover {
  color: #0FA0CE; }
.button,
button,
input[type="submit"],
input[type="reset"],
input[type="button"] {
  display: inline-block;
  height: 38px;
  padding: 0 30px;
  color: #555;
  text-align: center;
  font-size: 11px;
  font-weight: 600;
  line-height: 38px;
  letter-spacing: .1rem;
  text-transform: uppercase;
  text-decoration: none;
  white-space: nowrap;
  background-color: transparent;
  border-radius: 4px;
  border: 1px solid #bbb;
  cursor: pointer;
  box-sizing: border-box; }
.button:hover,
button:hover,
input[type="submit"]:hover,
input[type="reset"]:hover,
input[type="button"]:hover,
.button:focus,
button:focus,
input[type="submit"]:focus,
input[type="reset"]:focus,
input[type="button"]:focus {
  color: #333;
  border-color: #888;
  outline: 0; }
.button.button-primary,
button.button-primary,
input[type="submit"].button-primary,
input[type="reset"].button-primary,
input[type="button"].button-primary {
  color: #FFF;
  background-color: #33C3F0;
  border-color: #33C3F0; }
.button.button-primary:hover,
button.button-primary:hover,
input[type="submit"].button-primary:hover,
input[type="reset"].button-primary:hover,
input[type="button"].button-primary:hover,
.button.button-primary:focus,
button.button-primary:focus,
input[type="submit"].button-primary:focus,
input[type="reset"].button-primary:focus,
input[type="button"].button-primary:focus {
  color: #FFF;
  background-color: #1EAEDB;
  border-color: #1EAEDB; }
input[type="email"],
input[type="number"],
input[type="search"],
input[type="text"],
input[type="tel"],
input[type="url"],
input[type="password"],
textarea,
select {
  height: 38px;
  padding: 6px 10px; /* The 6px vertically centers text on FF, ignored by Webkit */
  background-color: #fff;
  border: 1px solid #D1D1D1;
  border-radius: 4px;
  box-shadow: none;
  box-sizing: border-box; }
/* Removes awkward default styles on some inputs for iOS */
input[type="email"],
input[type="number"],
input[type="search"],
input[type="text"],
input[type="tel"],
input[type="url"],
input[type="password"],
textarea {
  -webkit-appearance: none;
     -moz-appearance: none;
          appearance: none; }
textarea {
  min-height: 65px;
  padding-top: 6px;
  padding-bottom: 6px; }
input[type="email"]:focus,
input[type="number"]:focus,
input[type="search"]:focus,
input[type="text"]:focus,
input[type="tel"]:focus,
input[type="url"]:focus,
input[type="password"]:focus,
textarea:focus,
select:focus {
  border: 1px solid #33C3F0;
  outline: 0; }
label,
legend {
  display: block;
  margin-bottom: .5rem;
  font-weight: 600; }
fieldset {
  padding: 0;
  border-width: 0; }
input[type="checkbox"],
input[type="radio"] {
  display: inline; }
label > .label-body {
  display: inline-block;
  margin-left: .5rem;
  font-weight: normal; }
ul {
  list-style: circle inside; }
ol {
  list-style: decimal inside; }
ol, ul {
  padding-left: 0;
  margin-top: 0; }
ul ul,
ul ol,
ol ol,
ol ul {
  margin: 1.5rem 0 1.5rem 3rem;
  font-size: 90%; }
li {
  margin-bottom: 1rem; }
th,
td {
  padding: 12px 15px;
  text-align: left;
  border-bottom: 1px solid #E1E1E1; }
th:first-child,
td:first-child {
  padding-left: 0; }
th:last-child,
td:last-child {
  padding-right: 0; }
button,
.button {
  margin-bottom: 1rem; }
input,
textarea,
select,
fieldset {
  margin-bottom: 1.5rem; }
pre,
blockquote,
dl,
figure,
table,
p,
ul,
ol,
form {
  margin-bottom: 2.5rem; }
.u-full-width {
  width: 100%;
  box-sizing: border-box; }
.u-max-full-width {
  max-width: 100%;
  box-sizing: border-box; }
.u-pull-right {
  float: right; }
.u-pull-left {
  float: left; }
hr {
  margin-top: 3rem;
  margin-bottom: 3.5rem;
  border-width: 0;
  border-top: 1px solid #E1E1E1; }
.container:after,
.row:after,
.u-cf {
  content: "";
  display: table;
  clear: both; }

pre {
  display: block;
  padding: 9.5px;
  margin: 0 0 10px;
  font-size: 13px;
  line-height: 1.42857143;
  color: #333;
  word-break: break-all;
  word-wrap: break-word;
  background-color: #f5f5f5;
  border: 1px solid #ccc;
  border-radius: 4px;
}
code,
kbd,
pre,
samp {
  font-family: Menlo, Monaco, Consolas, "Courier New", monospace;
}
code {
  padding: 2px 4px;
  font-size: 90%;
  color: #c7254e;
  background-color: #f9f2f4;
  border-radius: 4px;
}

@media (min-width: 400px) {}
@media (min-width: 550px) {}
@media (min-width: 750px) {}
@media (min-width: 1000px) {}
@media (min-width: 1200px) {}

</style>

<style>
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.hll { background-color: #ffffcc }
.c { color: #3D7B7B; font-style: italic } /* Comment */
.err { border: 1px solid #FF0000 } /* Error */
.k { color: #008000; font-weight: bold } /* Keyword */
.o { color: #666666 } /* Operator */
.ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
.cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
.cp { color: #9C6500 } /* Comment.Preproc */
.cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
.c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
.cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
.gd { color: #A00000 } /* Generic.Deleted */
.ge { font-style: italic } /* Generic.Emph */
.gr { color: #E40000 } /* Generic.Error */
.gh { color: #000080; font-weight: bold } /* Generic.Heading */
.gi { color: #008400 } /* Generic.Inserted */
.go { color: #717171 } /* Generic.Output */
.gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.gs { font-weight: bold } /* Generic.Strong */
.gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.gt { color: #0044DD } /* Generic.Traceback */
.kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.kp { color: #008000 } /* Keyword.Pseudo */
.kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.kt { color: #B00040 } /* Keyword.Type */
.m { color: #666666 } /* Literal.Number */
.s { color: #BA2121 } /* Literal.String */
.na { color: #687822 } /* Name.Attribute */
.nb { color: #008000 } /* Name.Builtin */
.nc { color: #0000FF; font-weight: bold } /* Name.Class */
.no { color: #880000 } /* Name.Constant */
.nd { color: #AA22FF } /* Name.Decorator */
.ni { color: #717171; font-weight: bold } /* Name.Entity */
.ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
.nf { color: #0000FF } /* Name.Function */
.nl { color: #767600 } /* Name.Label */
.nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.nt { color: #008000; font-weight: bold } /* Name.Tag */
.nv { color: #19177C } /* Name.Variable */
.ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.w { color: #bbbbbb } /* Text.Whitespace */
.mb { color: #666666 } /* Literal.Number.Bin */
.mf { color: #666666 } /* Literal.Number.Float */
.mh { color: #666666 } /* Literal.Number.Hex */
.mi { color: #666666 } /* Literal.Number.Integer */
.mo { color: #666666 } /* Literal.Number.Oct */
.sa { color: #BA2121 } /* Literal.String.Affix */
.sb { color: #BA2121 } /* Literal.String.Backtick */
.sc { color: #BA2121 } /* Literal.String.Char */
.dl { color: #BA2121 } /* Literal.String.Delimiter */
.sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.s2 { color: #BA2121 } /* Literal.String.Double */
.se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
.sh { color: #BA2121 } /* Literal.String.Heredoc */
.si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
.sx { color: #008000 } /* Literal.String.Other */
.sr { color: #A45A77 } /* Literal.String.Regex */
.s1 { color: #BA2121 } /* Literal.String.Single */
.ss { color: #19177C } /* Literal.String.Symbol */
.bp { color: #008000 } /* Name.Builtin.Pseudo */
.fm { color: #0000FF } /* Name.Function.Magic */
.vc { color: #19177C } /* Name.Variable.Class */
.vg { color: #19177C } /* Name.Variable.Global */
.vi { color: #19177C } /* Name.Variable.Instance */
.vm { color: #19177C } /* Name.Variable.Magic */
.il { color: #666666 } /* Literal.Number.Integer.Long */
</style>





<style>
h1.title {margin-top : 20px}
img {max-width : 100%}

#From nbconvert
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-bold { font-weight: bold; }
</style>

</HEAD>
<BODY>
    <div class ="container">
        <div class = "row">
            <div class = "col-md-12 twelve columns">

<div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;st5442_Assignment4.ipynb</span>

<span class="sd">Automatically generated by Colab.</span>

<span class="sd">Original file is located at</span>
<span class="sd">    https://colab.research.google.com/drive/1HcKbhluCFhBafbTjS_DJJk3tFM-wB_Ng</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">bokeh.plotting</span> <span class="kn">import</span> <span class="n">figure</span><span class="p">,</span> <span class="n">show</span><span class="p">,</span> <span class="n">output_notebook</span>
<span class="kn">from</span> <span class="nn">bokeh.models</span> <span class="kn">import</span> <span class="n">ColumnDataSource</span><span class="p">,</span> <span class="n">HoverTool</span><span class="p">,</span> <span class="n">RangeSlider</span><span class="p">,</span> <span class="n">Button</span><span class="p">,</span> <span class="n">NumeralTickFormatter</span>
<span class="kn">from</span> <span class="nn">bokeh.layouts</span> <span class="kn">import</span> <span class="n">column</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">gridplot</span>
<span class="kn">from</span> <span class="nn">bokeh.io</span> <span class="kn">import</span> <span class="n">push_notebook</span>
<span class="kn">from</span> <span class="nn">bokeh.models</span> <span class="kn">import</span> <span class="n">CustomJS</span><span class="p">,</span> <span class="n">PrintfTickFormatter</span>
<span class="kn">from</span> <span class="nn">bokeh.models</span> <span class="kn">import</span> <span class="n">Div</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">from</span> <span class="nn">bokeh.models</span> <span class="kn">import</span> <span class="n">GeoJSONDataSource</span><span class="p">,</span> <span class="n">CustomJS</span><span class="p">,</span> <span class="n">CheckboxButtonGroup</span><span class="p">,</span> <span class="n">ColorBar</span>
<span class="kn">from</span> <span class="nn">bokeh.palettes</span> <span class="kn">import</span> <span class="n">Viridis256</span>
<span class="kn">from</span> <span class="nn">bokeh.transform</span> <span class="kn">import</span> <span class="n">linear_cmap</span>
<span class="kn">from</span> <span class="nn">bokeh.models</span> <span class="kn">import</span> <span class="n">Legend</span><span class="p">,</span> <span class="n">Select</span><span class="p">,</span> <span class="n">LabelSet</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">bokeh.models</span> <span class="kn">import</span> <span class="n">ColorBar</span><span class="p">,</span> <span class="n">LinearColorMapper</span>
<span class="kn">from</span> <span class="nn">bokeh.models</span> <span class="kn">import</span> <span class="n">HoverTool</span>
<span class="kn">import</span> <span class="nn">pycountry_convert</span> <span class="k">as</span> <span class="nn">pc</span>
<span class="kn">import</span> <span class="nn">panel</span> <span class="k">as</span> <span class="nn">pn</span>
<span class="n">pn</span><span class="o">.</span><span class="n">extension</span><span class="p">()</span>

<span class="n">output_notebook</span><span class="p">()</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/Users/sanyuktatuti/downloads/st5442_Assignment4/global-plastics-production.csv&#39;</span><span class="p">)</span> <span class="c1">#the path needs to be inserted accordingly to recreate visualization</span>

<span class="n">df</span><span class="o">=</span><span class="n">data</span>

<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

<span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>

<span class="c1"># Creating the necessary data for the plot</span>
<span class="n">years</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">production</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Annual plastic production between 1950 and 2019&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

<span class="c1"># Scaling production values by dividing by 1 million (to convert from raw number to millions)</span>
<span class="n">scaled_production</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">/</span> <span class="mi">1000000</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">production</span><span class="p">]</span>

<span class="n">source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">Year</span><span class="o">=</span><span class="n">years</span><span class="p">,</span> <span class="n">Production</span><span class="o">=</span><span class="n">scaled_production</span><span class="p">))</span>

<span class="c1"># Creating the figure with larger size</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Global Plastics Production (1950-2019)&quot;</span><span class="p">,</span> <span class="n">x_axis_label</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">y_axis_label</span><span class="o">=</span><span class="s1">&#39;Production (Millions of Tons)&#39;</span><span class="p">,</span>
           <span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>  <span class="c1"># Increase width and height</span>

<span class="c1"># Setting the title font size</span>
<span class="n">p</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">text_font_size</span> <span class="o">=</span> <span class="s2">&quot;20pt&quot;</span>  <span class="c1"># Adjust the font size of the title</span>
<span class="n">p</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">text_font</span> <span class="o">=</span> <span class="s2">&quot;Times New Roman&quot;</span>

<span class="c1"># Creating the line plot</span>
<span class="n">line</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Production&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">)</span>

<span class="c1"># Adding smaller circles (dots) with a different color (e.g., green)</span>
<span class="n">dots</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Production&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>

<span class="c1"># Creating hover tool to show year and production values dynamically</span>
<span class="n">hover</span> <span class="o">=</span> <span class="n">HoverTool</span><span class="p">()</span>
<span class="n">hover</span><span class="o">.</span><span class="n">tooltips</span> <span class="o">=</span> <span class="p">[(</span><span class="s2">&quot;Year&quot;</span><span class="p">,</span> <span class="s2">&quot;@Year&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;Production&quot;</span><span class="p">,</span> <span class="s2">&quot;@Production</span><span class="si">{0.0}</span><span class="s2"> million&quot;</span><span class="p">)]</span>
<span class="n">p</span><span class="o">.</span><span class="n">add_tools</span><span class="p">(</span><span class="n">hover</span><span class="p">)</span>

<span class="c1"># Creating a range slider with two cursors and larger size</span>
<span class="n">range_slider</span> <span class="o">=</span> <span class="n">RangeSlider</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">1950</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mi">2019</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="p">(</span><span class="mi">1950</span><span class="p">,</span> <span class="mi">2019</span><span class="p">),</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Year Range&quot;</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">)</span>

<span class="c1"># JavaScript callback for Bokeh to filter data dynamically based on the range slider</span>
<span class="n">callback_code</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    const data = source.data;</span>
<span class="s2">    const start_year = range_slider.value[0];</span>
<span class="s2">    const end_year = range_slider.value[1];</span>
<span class="s2">    const all_years = </span><span class="si">%s</span><span class="s2">;</span>
<span class="s2">    const all_production = </span><span class="si">%s</span><span class="s2">;</span>
<span class="s2">    data[&#39;Year&#39;] = [];</span>
<span class="s2">    data[&#39;Production&#39;] = [];</span>
<span class="s2">    for (let i = 0; i &lt; all_years.length; i++) {</span>
<span class="s2">        if (all_years[i] &gt;= start_year &amp;&amp; all_years[i] &lt;= end_year) {</span>
<span class="s2">            data[&#39;Year&#39;].push(all_years[i]);</span>
<span class="s2">            data[&#39;Production&#39;].push(all_production[i]);</span>
<span class="s2">        }</span>
<span class="s2">    }</span>
<span class="s2">    source.change.emit();</span>
<span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">years</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">scaled_production</span><span class="p">))</span>

<span class="c1"># Linking the range slider to the callback</span>
<span class="n">range_slider</span><span class="o">.</span><span class="n">js_on_change</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="n">CustomJS</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span> <span class="n">range_slider</span><span class="o">=</span><span class="n">range_slider</span><span class="p">),</span> <span class="n">code</span><span class="o">=</span><span class="n">callback_code</span><span class="p">))</span>

<span class="c1"># Setting the y-axis tick formatter to display values in &quot;Millions of Tons&quot; format</span>
<span class="n">p</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">formatter</span> <span class="o">=</span> <span class="n">PrintfTickFormatter</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%1.1f</span><span class="s2"> million&quot;</span><span class="p">)</span>

<span class="c1"># Function to animate the range slider (using JavaScript)</span>
<span class="n">play_button</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Play&quot;</span><span class="p">,</span> <span class="n">button_type</span><span class="o">=</span><span class="s2">&quot;success&quot;</span><span class="p">)</span>

<span class="n">play_callback_code</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    let start_year = range_slider.value[0];</span>
<span class="s2">    let end_year = start_year;  // Start the end_year from the start_year value</span>
<span class="s2">    let final_year = 2019;</span>
<span class="s2">    let interval;</span>

<span class="s2">    function updateRange() {</span>
<span class="s2">        if (end_year &lt; final_year) {</span>
<span class="s2">            end_year++;</span>
<span class="s2">            range_slider.value = [start_year, end_year];</span>
<span class="s2">        } else {</span>
<span class="s2">            clearInterval(interval);</span>
<span class="s2">        }</span>
<span class="s2">    }</span>

<span class="s2">    interval = setInterval(updateRange, 100);  // 100ms interval for animation</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># Adding play button with the play animation callback</span>
<span class="n">play_button</span><span class="o">.</span><span class="n">js_on_click</span><span class="p">(</span><span class="n">CustomJS</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">range_slider</span><span class="o">=</span><span class="n">range_slider</span><span class="p">),</span> <span class="n">code</span><span class="o">=</span><span class="n">play_callback_code</span><span class="p">))</span>

<span class="c1"># Introduction text</span>
<span class="n">introduction</span> <span class="o">=</span> <span class="n">Div</span><span class="p">(</span>
    <span class="n">text</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    &lt;h1 style=&quot;text-align:center;&quot;&gt;The Plastic Problem and Global Perspectives&lt;/h1&gt;</span>
<span class="s2">    &lt;p style=&quot;text-align: justify; font-size: 14px; margin-top: 10px;&quot;&gt;</span>
<span class="s2">        Plastic pollution has become one of the most pressing environmental challenges of our time.</span>
<span class="s2">        From mismanaged waste on land to the vast quantities of plastic accumulating in our oceans,</span>
<span class="s2">        the impact of this crisis is both global and deeply personal.</span>
<span class="s2">    &lt;/p&gt;</span>
<span class="s2">    &lt;p style=&quot;text-align: justify; font-size: 14px; margin-top: 10px;&quot;&gt;</span>
<span class="s2">        This series of visualizations offers a multifaceted view of plastic waste, examining how economic, regional, and environmental factors intertwine to shape this growing problem. We delve into the relationship between economic prosperity and waste management efficiency, uncover regional trends in mismanaged waste, and explore the types of plastic polluting our oceans. Through these insights, we aim to highlight not only the scope of the issue but also potential paths for action.</span>
<span class="s2">    &lt;/p&gt;</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Creating the description</span>
<span class="n">description</span> <span class="o">=</span> <span class="n">Div</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;    &lt;h1 style=&quot;text-align:left;&quot;&gt;From Progress to Pollution:&lt;/h1&gt;</span>
<span class="s2">&lt;p style=&quot;text-align: justify; font-size: 14px; margin-top: 10px;&quot;&gt;</span>
<span class="s2">This interactive visualization captures the dramatic increase in global plastic production,</span>
<span class="s2">charting its rise from 1950 to 2019 in millions of tons. With tools to explore specific time ranges</span>
<span class="s2">and an animated playback feature, the graph presents an evolving story of humanity’s reliance on plastic—and its consequences.&lt;br&gt;&lt;br&gt;</span>
<span class="s2">Hover over data points to uncover the scale of production year by year, and let the narrative guide you to reflect</span>
<span class="s2">on the urgent need for sustainable solutions. This is more than data—it’s a call to action for a cleaner, greener future.</span>
<span class="s2">&lt;/p&gt;&quot;&quot;&quot;</span><span class="p">)</span>

<span class="c1"># Updating the layout to include the description</span>
<span class="n">layout1</span> <span class="o">=</span> <span class="n">column</span><span class="p">(</span><span class="n">introduction</span><span class="p">,</span> <span class="n">description</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">range_slider</span><span class="p">,</span> <span class="n">play_button</span><span class="p">)</span>
<span class="c1">#show(layout)</span>
<span class="c1">#pn.serve(layout)</span>


<span class="c1"># Display plot and range slider</span>
<span class="c1">#layout = column(p, range_slider, play_button)</span>
<span class="c1">#show(layout)</span>

<span class="n">data2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/Users/sanyuktatuti/downloads/st5442_Assignment4/plastic-production-by-sector.csv&#39;</span><span class="p">)</span> <span class="c1">#the path needs to be inserted accordingly to recreate visualization</span>

<span class="n">df2</span> <span class="o">=</span> <span class="n">data2</span>

<span class="n">df2</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

<span class="n">df2</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>

<span class="c1"># Load data</span>
<span class="n">data_path</span> <span class="o">=</span> <span class="s1">&#39;/Users/sanyuktatuti/downloads/st5442_Assignment4/plastic-production-by-sector.csv&#39;</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span>
    <span class="s1">&#39;Road marking&#39;</span><span class="p">:</span> <span class="s1">&#39;Road_marking&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Marine coatings&#39;</span><span class="p">:</span> <span class="s1">&#39;Marine_coatings&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Personal care products&#39;</span><span class="p">:</span> <span class="s1">&#39;Personal_care_products&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Industrial machinery&#39;</span><span class="p">:</span> <span class="s1">&#39;Industrial_machinery&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Electronics&#39;</span><span class="p">:</span> <span class="s1">&#39;Electronics&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Textile sector&#39;</span><span class="p">:</span> <span class="s1">&#39;Textile_sector&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Consumer and institutional products&#39;</span><span class="p">:</span> <span class="s1">&#39;Consumer_and_institutional_products&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Transportation&#39;</span><span class="p">:</span> <span class="s1">&#39;Transportation&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Other&#39;</span><span class="p">:</span> <span class="s1">&#39;Other&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Building and construction&#39;</span><span class="p">:</span> <span class="s1">&#39;Building_and_construction&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Packaging&#39;</span><span class="p">:</span> <span class="s1">&#39;Packaging&#39;</span>
<span class="p">})</span>

<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

<span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>

<span class="c1"># Data preparation</span>
<span class="n">sectors</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Packaging&quot;</span><span class="p">,</span> <span class="s2">&quot;Building_and_construction&quot;</span><span class="p">,</span> <span class="s2">&quot;Other&quot;</span><span class="p">,</span> <span class="s2">&quot;Transportation&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Consumer_and_institutional_products&quot;</span><span class="p">,</span> <span class="s2">&quot;Textile_sector&quot;</span><span class="p">,</span> <span class="s2">&quot;Electronics&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Industrial_machinery&quot;</span><span class="p">,</span> <span class="s2">&quot;Personal_care_products&quot;</span><span class="p">,</span> <span class="s2">&quot;Marine_coatings&quot;</span><span class="p">,</span> <span class="s2">&quot;Road_marking&quot;</span>
<span class="p">]</span>

<span class="c1"># Scale production values to millions and create cumulative stacked data</span>
<span class="n">df_scaled</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">sectors</span><span class="p">]</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="mi">1_000_000</span><span class="p">)</span>  <span class="c1"># Scaling by 1,000,000</span>
<span class="n">df_scaled</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span>  <span class="c1"># Add the Year column back</span>
<span class="n">df_stacked</span> <span class="o">=</span> <span class="n">df_scaled</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Cumulative sum for stacking</span>
<span class="n">df_stacked</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span>  <span class="c1"># Add the Year column back</span>

<span class="n">df_stacked</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">df_stacked</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

<span class="c1"># Create ColumnDataSource for the plot</span>
<span class="n">source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df_stacked</span><span class="p">)</span>

<span class="c1"># Initialize the Bokeh plot</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Global Primary Plastic Production by Industrial Sector (1990-2019)&quot;</span><span class="p">,</span>
    <span class="n">x_axis_label</span><span class="o">=</span><span class="s2">&quot;Year&quot;</span><span class="p">,</span>
    <span class="n">y_axis_label</span><span class="o">=</span><span class="s2">&quot;Plastic Production (Millions of Tonnes)&quot;</span><span class="p">,</span>
    <span class="n">x_range</span><span class="o">=</span><span class="p">(</span><span class="mi">1990</span><span class="p">,</span> <span class="mi">2019</span><span class="p">),</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">700</span>
<span class="p">)</span>


<span class="c1"># Setting the title font size</span>
<span class="n">p</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">text_font_size</span> <span class="o">=</span> <span class="s2">&quot;20pt&quot;</span>  <span class="c1"># Adjust the font size of the title</span>
<span class="n">p</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">text_font</span> <span class="o">=</span> <span class="s2">&quot;Times New Roman&quot;</span>

<span class="c1"># Muted earthy color palette (refined for clarity)</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;#7D4B47&quot;</span><span class="p">,</span> <span class="s2">&quot;#5F6A6A&quot;</span><span class="p">,</span> <span class="s2">&quot;#A9B1A0&quot;</span><span class="p">,</span> <span class="s2">&quot;#A17961&quot;</span><span class="p">,</span> <span class="s2">&quot;#617B7B&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#7C8C4F&quot;</span><span class="p">,</span> <span class="s2">&quot;#B28B3B&quot;</span><span class="p">,</span> <span class="s2">&quot;#6C5A4A&quot;</span><span class="p">,</span> <span class="s2">&quot;#9A7C54&quot;</span><span class="p">,</span> <span class="s2">&quot;#B4B98B&quot;</span><span class="p">,</span> <span class="s2">&quot;#6C9A8B&quot;</span>
<span class="p">]</span>

<span class="c1"># Create a function to generate stacked areas in the order of legend sectors</span>
<span class="k">def</span> <span class="nf">create_stacked_areas</span><span class="p">(</span><span class="n">sectors</span><span class="p">,</span> <span class="n">df_stacked</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
    <span class="n">renderers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">legend_items</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Loop through the sectors and create stacked areas</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">sector</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sectors</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">renderer</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">varea</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y2</span><span class="o">=</span><span class="n">sector</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">renderer</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">varea</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span>
                <span class="n">y1</span><span class="o">=</span><span class="n">sectors</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span>
                <span class="n">y2</span><span class="o">=</span><span class="n">sector</span><span class="p">,</span>
                <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="n">renderers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">renderer</span><span class="p">)</span>
        <span class="n">legend_items</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">sector</span><span class="p">,</span> <span class="p">[</span><span class="n">renderer</span><span class="p">]))</span>

    <span class="k">return</span> <span class="n">renderers</span><span class="p">,</span> <span class="n">legend_items</span>

<span class="c1"># Generate the stacked areas and legend</span>
<span class="n">renderers</span><span class="p">,</span> <span class="n">legend_items</span> <span class="o">=</span> <span class="n">create_stacked_areas</span><span class="p">(</span><span class="n">sectors</span><span class="p">,</span> <span class="n">df_stacked</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

<span class="c1"># Reverse the legend items</span>
<span class="n">legend_items_reversed</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">legend_items</span><span class="p">))</span>

<span class="c1"># Add a reversed legend outside the plot, matching the order in the plot</span>
<span class="n">legend</span> <span class="o">=</span> <span class="n">Legend</span><span class="p">(</span><span class="n">items</span><span class="o">=</span><span class="n">legend_items_reversed</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Industrial Sectors&quot;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">legend</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">)</span>

<span class="c1"># Hover tool for interactivity with reversed tooltip order</span>
<span class="n">hover</span> <span class="o">=</span> <span class="n">HoverTool</span><span class="p">()</span>
<span class="n">hover</span><span class="o">.</span><span class="n">tooltips</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;Year&quot;</span><span class="p">,</span> <span class="s2">&quot;@Year&quot;</span><span class="p">),</span>
<span class="p">]</span>

<span class="c1"># Reverse the order of sectors in the tooltip</span>
<span class="k">for</span> <span class="n">sector</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">sectors</span><span class="p">):</span>  <span class="c1"># Reverse the sectors for the tooltip</span>
    <span class="n">hover</span><span class="o">.</span><span class="n">tooltips</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">sector</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;@</span><span class="si">{</span><span class="n">sector</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>

<span class="n">p</span><span class="o">.</span><span class="n">add_tools</span><span class="p">(</span><span class="n">hover</span><span class="p">)</span>

<span class="c1"># Dropdown menu for selecting a sector</span>
<span class="n">dropdown</span> <span class="o">=</span> <span class="n">Select</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Highlight Sector:&quot;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;All&quot;</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;All&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">sectors</span><span class="p">)</span>

<span class="c1"># JavaScript callback for dropdown menu to toggle the visibility of sectors</span>
<span class="n">dropdown_callback_code</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">const selected_sector = dropdown.value;</span>
<span class="s2">for (let i = 0; i &lt; renderers.length; i++) {</span>
<span class="s2">    renderers[i].visible = (selected_sector === &quot;All&quot; || sectors[i] === selected_sector);</span>
<span class="s2">}</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">dropdown_callback</span> <span class="o">=</span> <span class="n">CustomJS</span><span class="p">(</span>
    <span class="n">args</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">renderers</span><span class="o">=</span><span class="n">renderers</span><span class="p">,</span> <span class="n">dropdown</span><span class="o">=</span><span class="n">dropdown</span><span class="p">,</span> <span class="n">sectors</span><span class="o">=</span><span class="n">sectors</span><span class="p">),</span>
    <span class="n">code</span><span class="o">=</span><span class="n">dropdown_callback_code</span>
<span class="p">)</span>
<span class="n">dropdown</span><span class="o">.</span><span class="n">js_on_change</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="n">dropdown_callback</span><span class="p">)</span>

<span class="c1"># Add a RangeSlider for filtering data</span>
<span class="n">range_slider</span> <span class="o">=</span> <span class="n">RangeSlider</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mi">1990</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mi">2019</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="p">(</span><span class="mi">1990</span><span class="p">,</span> <span class="mi">1990</span><span class="p">),</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Year Range&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">900</span><span class="p">)</span>

<span class="c1"># JavaScript callback for RangeSlider</span>
<span class="n">slider_callback_code</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">const start = range_slider.value[0];</span>
<span class="s2">const end = range_slider.value[1];</span>
<span class="s2">const filtered_data = {Year: [], };</span>
<span class="s2">for (const sector of sectors) { filtered_data[sector] = []; }</span>

<span class="s2">for (let i = 0; i &lt; all_years.length; i++) {</span>
<span class="s2">    if (all_years[i] &gt;= start &amp;&amp; all_years[i] &lt;= end) {</span>
<span class="s2">        filtered_data[&#39;Year&#39;].push(all_years[i]);</span>
<span class="s2">        for (const sector of sectors) {</span>
<span class="s2">            filtered_data[sector].push(all_sectors[sector][i]);</span>
<span class="s2">        }</span>
<span class="s2">    }</span>
<span class="s2">}</span>
<span class="s2">source.data = filtered_data;</span>
<span class="s2">source.change.emit();</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">all_years</span> <span class="o">=</span> <span class="n">df_stacked</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">all_sectors</span> <span class="o">=</span> <span class="p">{</span><span class="n">sector</span><span class="p">:</span> <span class="n">df_stacked</span><span class="p">[</span><span class="n">sector</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="k">for</span> <span class="n">sector</span> <span class="ow">in</span> <span class="n">sectors</span><span class="p">}</span>
<span class="n">range_slider</span><span class="o">.</span><span class="n">js_on_change</span><span class="p">(</span>
    <span class="s1">&#39;value&#39;</span><span class="p">,</span>
    <span class="n">CustomJS</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span> <span class="n">range_slider</span><span class="o">=</span><span class="n">range_slider</span><span class="p">,</span> <span class="n">all_years</span><span class="o">=</span><span class="n">all_years</span><span class="p">,</span> <span class="n">all_sectors</span><span class="o">=</span><span class="n">all_sectors</span><span class="p">,</span> <span class="n">sectors</span><span class="o">=</span><span class="n">sectors</span><span class="p">),</span> <span class="n">code</span><span class="o">=</span><span class="n">slider_callback_code</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Add a Play button for animation</span>
<span class="n">play_button</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Play&quot;</span><span class="p">,</span> <span class="n">button_type</span><span class="o">=</span><span class="s2">&quot;success&quot;</span><span class="p">)</span>

<span class="c1"># JavaScript callback for the Play button with smoother animation and dynamic x-axis range update</span>
<span class="n">play_callback_code</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">let playing = false;</span>
<span class="s2">let interval;</span>

<span class="s2">play_button.on_click(() =&gt; {</span>
<span class="s2">    playing = !playing; // Toggle play/pause</span>
<span class="s2">    play_button.label = playing ? &quot;Pause&quot; : &quot;Play&quot;;</span>

<span class="s2">    if (playing) {</span>
<span class="s2">        interval = setInterval(() =&gt; {</span>
<span class="s2">            const [start, end] = range_slider.value;</span>
<span class="s2">            if (end &gt;= range_slider.end) {</span>
<span class="s2">                clearInterval(interval); // Stop if the max year is reached</span>
<span class="s2">                play_button.label = &quot;Play&quot;; // Reset button</span>
<span class="s2">                playing = false;</span>
<span class="s2">            } else {</span>
<span class="s2">                range_slider.value = [start, end + 1]; // Increment the upper bound</span>

<span class="s2">                // Dynamically adjust the x-axis range based on the year range</span>
<span class="s2">                p.x_range.start = start; // Update the starting point of the x-axis</span>
<span class="s2">                p.x_range.end = end; // Update the ending point of the x-axis</span>
<span class="s2">            }</span>
<span class="s2">        }, 300); // Smooth update every 300ms</span>
<span class="s2">    } else {</span>
<span class="s2">        clearInterval(interval); // Pause the animation</span>
<span class="s2">    }</span>
<span class="s2">});</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">play_button</span><span class="o">.</span><span class="n">js_on_click</span><span class="p">(</span>
    <span class="n">CustomJS</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">range_slider</span><span class="o">=</span><span class="n">range_slider</span><span class="p">,</span> <span class="n">play_button</span><span class="o">=</span><span class="n">play_button</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">),</span> <span class="n">code</span><span class="o">=</span><span class="n">play_callback_code</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Narrative introduction</span>
<span class="n">narrative</span> <span class="o">=</span> <span class="n">Div</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;&lt;h1 style=&quot;text-align:left;&quot;&gt;Tracing the Footprints of Plastic: Industrial Growth and Sustainability:&lt;/h1&gt;</span>
<span class="s2">&lt;p style=&quot;text-align: justify; font-size: 14px; margin-top: 10px;&quot;&gt;</span>
<span class="s2">In our journey through plastic production, we saw the relentless rise of plastic as a cornerstone of modern life.</span>
<span class="s2">But where does it all go? This visualization shifts the lens to focus on the industrial sectors that drive global plastic production.</span>
<span class="s2">Each layer tells a story—a story of packaging, construction, and consumer products—and the complex interplay of human needs and environmental costs.&lt;br&gt;&lt;br&gt;</span>
<span class="s2">As you explore this visualization, consider how our reliance on plastic infiltrates every aspect of industry and daily life.</span>
<span class="s2">Let it prompt reflection: What role can innovation play in transforming these sectors toward sustainability?</span>
<span class="s2">The challenge is daunting, but every story has a turning point. Let this be ours.</span>
<span class="s2">&lt;/p&gt;&quot;&quot;&quot;</span><span class="p">)</span>

<span class="c1"># Update layout to include the narrative</span>
<span class="n">layout2</span> <span class="o">=</span> <span class="n">column</span><span class="p">(</span><span class="n">narrative</span><span class="p">,</span> <span class="n">dropdown</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">row</span><span class="p">(</span><span class="n">play_button</span><span class="p">,</span> <span class="n">range_slider</span><span class="p">))</span>
<span class="n">output_notebook</span><span class="p">()</span>
<span class="c1">#show(layout)</span>
<span class="c1">#pn.serve(layout)</span>

<span class="c1"># Layout and show (reversed order of range_slider and play_button)</span>
<span class="c1">#layout = column(dropdown, p, row(play_button, range_slider))</span>
<span class="c1">#output_notebook()</span>
<span class="c1">#show(layout)</span>

<span class="n">data3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/Users/sanyuktatuti/downloads/st5442_Assignment4/plastic-waste-generation-total.csv&#39;</span><span class="p">)</span> <span class="c1">#the path needs to be inserted accordingly to recreate visualization</span>

<span class="n">df3</span><span class="o">=</span><span class="n">data3</span>
<span class="n">df3</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="n">df3</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># Display Bokeh plots in the notebook</span>
<span class="n">output_notebook</span><span class="p">()</span>

<span class="c1"># Load the plastic waste dataset</span>
<span class="n">data_path</span> <span class="o">=</span> <span class="s1">&#39;/Users/sanyuktatuti/downloads/st5442_Assignment4/plastic-waste-generation-total.csv&#39;</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span>

<span class="c1"># Filter for the year 2010</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2010</span><span class="p">]</span>

<span class="c1"># Create a new column that formats the plastic waste generation values to millions</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;Plastic waste generation (millions of tonnes)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Plastic waste generation (tonnes, total)&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1_000_000</span>

<span class="c1"># Download and load a GeoJSON file for world boundaries</span>
<span class="n">world_path</span> <span class="o">=</span> <span class="s1">&#39;https://github.com/nvkelso/natural-earth-vector/raw/master/geojson/ne_110m_admin_0_countries.geojson&#39;</span>
<span class="n">world</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">world_path</span><span class="p">)</span>

<span class="c1"># Merge GeoDataFrame with the plastic waste dataset</span>
<span class="n">merged</span> <span class="o">=</span> <span class="n">world</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;ISO_A3&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;Code&#39;</span><span class="p">)</span>

<span class="c1"># Fill NaN values with 0 for visualization purposes (later will handle no-data separately)</span>
<span class="n">merged</span><span class="p">[</span><span class="s1">&#39;Plastic waste generation (millions of tonnes)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged</span><span class="p">[</span><span class="s1">&#39;Plastic waste generation (millions of tonnes)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Bin data into intervals for the interactive legend, scaled to millions</span>
<span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">merged</span><span class="p">[</span><span class="s1">&#39;Plastic waste generation (millions of tonnes)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span>
                   <span class="n">merged</span><span class="p">[</span><span class="s1">&#39;Plastic waste generation (millions of tonnes)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">6</span><span class="p">)</span>

<span class="c1"># Add a bin for &quot;No Data&quot; to the end</span>
<span class="n">bins_with_na</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bins</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">merged</span><span class="p">[</span><span class="s1">&#39;bin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">merged</span><span class="p">[</span><span class="s1">&#39;Plastic waste generation (millions of tonnes)&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">include_lowest</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Create labels for the interactive legend</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">bins_with_na</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">,.1f</span><span class="si">}</span><span class="s2">M - </span><span class="si">{</span><span class="n">bins_with_na</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">,.1f</span><span class="si">}</span><span class="s2">M&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bins_with_na</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
<span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;No Data&quot;</span><span class="p">)</span>

<span class="c1"># Remove the specific problematic label if it exists</span>
<span class="k">if</span> <span class="s2">&quot;59.1M - 0.0M&quot;</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
    <span class="n">labels</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;59.1M - 0.0M&quot;</span><span class="p">)</span>


<span class="n">legend_buttons</span> <span class="o">=</span> <span class="n">CheckboxButtonGroup</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>  <span class="c1"># Initially select the first bin</span>

<span class="c1"># Convert the merged GeoDataFrame to GeoJSON and add the new column &#39;Plastic waste generation (millions of tonnes)&#39;</span>
<span class="n">geo_source</span> <span class="o">=</span> <span class="n">GeoJSONDataSource</span><span class="p">(</span><span class="n">geojson</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">merged</span><span class="o">.</span><span class="n">to_json</span><span class="p">())))</span>


<span class="c1"># Calculate the color manually using Viridis256 palette</span>
<span class="n">min_value</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Plastic waste generation (millions of tonnes)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<span class="n">max_value</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;Plastic waste generation (millions of tonnes)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

<span class="c1"># Normalize the values to the range [0, 1] to use the Viridis256 palette</span>
<span class="n">normalized_values</span> <span class="o">=</span> <span class="p">(</span><span class="n">merged</span><span class="p">[</span><span class="s1">&#39;Plastic waste generation (millions of tonnes)&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">min_value</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">max_value</span> <span class="o">-</span> <span class="n">min_value</span><span class="p">)</span>

<span class="c1"># Map the normalized values to colors using the Viridis256 palette</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">Viridis256</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">value</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Viridis256</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))]</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">normalized_values</span><span class="p">]</span>

<span class="c1"># Add the colors as a new column to the geo_source</span>
<span class="n">merged</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">colors</span>  <span class="c1"># Add the color column to the merged DataFrame</span>
<span class="n">geo_source</span> <span class="o">=</span> <span class="n">GeoJSONDataSource</span><span class="p">(</span><span class="n">geojson</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">merged</span><span class="o">.</span><span class="n">to_json</span><span class="p">())))</span>

<span class="c1"># Create the Bokeh figure</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Plastic Waste Generation, 2019&#39;</span><span class="p">,</span>
           <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">950</span><span class="p">,</span>
           <span class="n">toolbar_location</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">tools</span><span class="o">=</span><span class="s1">&#39;pan, wheel_zoom, reset&#39;</span><span class="p">)</span>


<span class="c1"># Setting the title font size</span>
<span class="n">p</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">text_font_size</span> <span class="o">=</span> <span class="s2">&quot;20pt&quot;</span>  <span class="c1"># Adjust the font size of the title</span>
<span class="n">p</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">text_font</span> <span class="o">=</span> <span class="s2">&quot;Times New Roman&quot;</span>

<span class="c1"># Create the HoverTool for displaying the country name and plastic waste value</span>
<span class="n">hover</span> <span class="o">=</span> <span class="n">HoverTool</span><span class="p">()</span>
<span class="n">hover</span><span class="o">.</span><span class="n">tooltips</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;Country&quot;</span><span class="p">,</span> <span class="s2">&quot;@NAME&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Plastic Waste (Millions of Tonnes)&quot;</span><span class="p">,</span> <span class="s2">&quot;@{Plastic waste generation (millions of tonnes)}</span><span class="si">{0.0}</span><span class="s2">M&quot;</span><span class="p">)</span>
<span class="p">]</span>

<span class="c1"># Add the HoverTool to the figure</span>
<span class="n">p</span><span class="o">.</span><span class="n">add_tools</span><span class="p">(</span><span class="n">hover</span><span class="p">)</span>

<span class="c1"># Add patches (countries) to the figure</span>
<span class="n">p</span><span class="o">.</span><span class="n">patches</span><span class="p">(</span><span class="s1">&#39;xs&#39;</span><span class="p">,</span> <span class="s1">&#39;ys&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">geo_source</span><span class="p">,</span>
          <span class="n">fill_color</span><span class="o">=</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="s1">&#39;fill_alpha&#39;</span><span class="p">,</span>
          <span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># Initialize a dictionary to store original colors</span>
<span class="n">original_colors</span> <span class="o">=</span> <span class="p">{</span><span class="n">iso</span><span class="p">:</span> <span class="n">color</span> <span class="k">for</span> <span class="n">iso</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">merged</span><span class="p">[</span><span class="s1">&#39;ISO_A3&#39;</span><span class="p">],</span> <span class="n">colors</span><span class="p">)}</span>

<span class="c1"># Set initial fill_alpha to 0.7 for all countries and store original colors</span>
<span class="n">geojson_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">geo_source</span><span class="o">.</span><span class="n">geojson</span><span class="p">)</span>
<span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">geojson_data</span><span class="p">[</span><span class="s1">&#39;features&#39;</span><span class="p">]:</span>
    <span class="n">feature</span><span class="p">[</span><span class="s1">&#39;properties&#39;</span><span class="p">][</span><span class="s1">&#39;fill_alpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.7</span>
    <span class="n">feature</span><span class="p">[</span><span class="s1">&#39;properties&#39;</span><span class="p">][</span><span class="s1">&#39;fill_color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">original_colors</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">feature</span><span class="p">[</span><span class="s1">&#39;properties&#39;</span><span class="p">][</span><span class="s1">&#39;ISO_A3&#39;</span><span class="p">],</span> <span class="s2">&quot;#D3D3D3&quot;</span><span class="p">)</span>  <span class="c1"># Use original or gray color</span>
<span class="n">geo_source</span><span class="o">.</span><span class="n">geojson</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">geojson_data</span><span class="p">)</span>

<span class="c1"># Create the color map for the plastic waste generation data</span>
<span class="n">color_map</span> <span class="o">=</span> <span class="n">linear_cmap</span><span class="p">(</span><span class="n">field_name</span><span class="o">=</span><span class="s1">&#39;Plastic waste generation (millions of tonnes)&#39;</span><span class="p">,</span>
                        <span class="n">palette</span><span class="o">=</span><span class="n">Viridis256</span><span class="p">,</span> <span class="n">low</span><span class="o">=</span><span class="n">min_value</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="n">max_value</span><span class="p">)</span>

<span class="c1"># Add a title to the color bar</span>
<span class="n">color_bar</span> <span class="o">=</span> <span class="n">ColorBar</span><span class="p">(</span><span class="n">color_mapper</span><span class="o">=</span><span class="n">color_map</span><span class="p">[</span><span class="s1">&#39;transform&#39;</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
                     <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Plastic generation (millions of tonnes)&quot;</span><span class="p">)</span>

<span class="c1"># Add the color bar to the plot</span>
<span class="n">p</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">color_bar</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">)</span>


<span class="c1"># JavaScript callback for interactive legend</span>
<span class="c1"># JavaScript callback for interactive legend (adjusted for correct bin behavior)</span>
<span class="n">callback</span> <span class="o">=</span> <span class="n">CustomJS</span><span class="p">(</span><span class="n">args</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">geo_source</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins_with_na</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">buttons</span><span class="o">=</span><span class="n">legend_buttons</span><span class="p">,</span> <span class="n">original_colors</span><span class="o">=</span><span class="n">original_colors</span><span class="p">),</span> <span class="n">code</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    const data = JSON.parse(source.geojson);  // Parse GeoJSON</span>
<span class="s2">    const features = data.features;</span>

<span class="s2">    // Get active bins from the legend buttons</span>
<span class="s2">    const active_bins = buttons.active;</span>

<span class="s2">    // Define a light gray color for countries that are not selected</span>
<span class="s2">    const grayColor = &quot;#D3D3D3&quot;;  // Very light gray color</span>

<span class="s2">    // Iterate through features and update &#39;fill_color&#39; based on selected bins</span>
<span class="s2">    for (const feature of features) {</span>
<span class="s2">        const value = feature.properties[&#39;Plastic waste generation (millions of tonnes)&#39;];</span>
<span class="s2">        let bin = -1;</span>

<span class="s2">        // Check for &quot;No Data&quot; bin</span>
<span class="s2">        if (value === 0) {</span>
<span class="s2">            bin = bins.length;  // &quot;No Data&quot; bin should be at the end</span>
<span class="s2">        } else {</span>
<span class="s2">            // Identify the correct bin index</span>
<span class="s2">            for (let i = 0; i &lt; bins.length - 1; i++) {</span>
<span class="s2">                if (value &gt;= bins[i] &amp;&amp; value &lt; bins[i + 1]) {</span>
<span class="s2">                    bin = i;</span>
<span class="s2">                    break;</span>
<span class="s2">                }</span>
<span class="s2">            }</span>
<span class="s2">        }</span>

<span class="s2">        // Adjust fill color and alpha based on bin status</span>
<span class="s2">        if (active_bins.includes(bin)) {</span>
<span class="s2">            feature.properties[&#39;fill_color&#39;] = original_colors[feature.properties[&#39;ISO_A3&#39;]];  // Restore original color</span>
<span class="s2">            feature.properties[&#39;fill_alpha&#39;] = 0.7;  // Normal alpha for selected bins</span>
<span class="s2">        } else {</span>
<span class="s2">            feature.properties[&#39;fill_color&#39;] = grayColor;  // Set light gray color for unselected bins</span>
<span class="s2">            feature.properties[&#39;fill_alpha&#39;] = 0.3;  // Lower alpha for grayed-out countries</span>
<span class="s2">        }</span>
<span class="s2">    }</span>

<span class="s2">    // Update the GeoJSON source</span>
<span class="s2">    source.geojson = JSON.stringify(data);</span>
<span class="s2">    source.change.emit();</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>


<span class="c1"># Attach the callback to the buttons</span>
<span class="n">legend_buttons</span><span class="o">.</span><span class="n">js_on_change</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span>

<span class="c1"># Narrative introduction</span>
<span class="n">narrative</span> <span class="o">=</span> <span class="n">Div</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;&lt;h1 style=&quot;text-align:left;&quot;&gt;Plastic Borders: A Crisis Without Boundaries&lt;/h1&gt;</span>
<span class="s2">&lt;p style=&quot;text-align: justify; font-size: 14px; margin-top: 10px;&quot;&gt;</span>
<span class="s2">We&#39;ve traversed the sectors fueling plastic production, but now we zoom out to the global stage.</span>
<span class="s2">This visualization paints a sobering portrait of our planet in 2019—a snapshot of plastic waste generation that transcends borders.</span>
<span class="s2">Each country&#39;s hue reflects its contribution to this growing challenge.&lt;br&gt;&lt;br&gt;</span>
<span class="s2">Yet, this is not just a story of data; it&#39;s a call to action.</span>
<span class="s2">The plastic waste crisis is not confined to the regions in darker tones—it spills into oceans, seeps into soils,</span>
<span class="s2">and shapes the legacy we leave behind. Explore this map and reflect on the shared responsibility</span>
<span class="s2">to shift from waste to worth, from problems to solutions. Together, we can rewrite this story.</span>
<span class="s2">&lt;/p&gt;&quot;&quot;&quot;</span><span class="p">)</span>

<span class="c1"># Update layout to include the narrative</span>
<span class="n">layout3</span> <span class="o">=</span> <span class="n">column</span><span class="p">(</span><span class="n">narrative</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">legend_buttons</span><span class="p">)</span>
<span class="c1">#show(layout)</span>
<span class="c1">#pn.serve(layout)</span>


<span class="c1"># Display the map and custom legend together (no changes here)</span>
<span class="c1">#layout = column(p, legend_buttons)</span>
<span class="c1">#show(layout)</span>

<span class="n">data4</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/Users/sanyuktatuti/downloads/st5442_Assignment4/mismanaged-plastic-waste-per-capita.csv&#39;</span><span class="p">)</span> <span class="c1">#the path needs to be inserted accordingly to recreate visualization</span>
<span class="n">data5</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/Users/sanyuktatuti/downloads/st5442_Assignment4/GDP_per_capita.csv&#39;</span><span class="p">)</span> <span class="c1">#the path needs to be inserted accordingly to recreate visualization</span>

<span class="n">df4</span> <span class="o">=</span> <span class="n">data4</span>
<span class="n">df5</span> <span class="o">=</span> <span class="n">data5</span>

<span class="n">df4</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>

<span class="n">df4</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>

<span class="n">df5</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="n">df5</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>

<span class="c1"># Step 1: Clean df4 by renaming columns for clarity</span>
<span class="n">df4_cleaned</span> <span class="o">=</span> <span class="n">df4</span><span class="p">[[</span><span class="s1">&#39;Entity&#39;</span><span class="p">,</span> <span class="s1">&#39;Mismanaged plastic waste per capita (kg per year)&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Entity&#39;</span><span class="p">:</span> <span class="s1">&#39;Country Name&#39;</span><span class="p">})</span>

<span class="c1"># Step 2: Clean df5 by selecting the columns for Country Name and GDP per capita in 2019</span>
<span class="n">df5_cleaned</span> <span class="o">=</span> <span class="n">df5</span><span class="p">[[</span><span class="s1">&#39;Country Name&#39;</span><span class="p">,</span> <span class="s1">&#39;2019 [YR2019]&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;2019 [YR2019]&#39;</span><span class="p">:</span> <span class="s1">&#39;GDP per capita (USD)&#39;</span><span class="p">})</span>

<span class="c1"># Step 3: Merge the two dataframes on &#39;Country Name&#39; (use an outer join to keep all countries from df4)</span>
<span class="n">merged_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df4_cleaned</span><span class="p">,</span> <span class="n">df5_cleaned</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;Country Name&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>

<span class="n">num_rows</span> <span class="o">=</span> <span class="n">merged_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of rows: </span><span class="si">{</span><span class="n">num_rows</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Function to get continent based on country name</span>
<span class="k">def</span> <span class="nf">get_continent</span><span class="p">(</span><span class="n">country_name</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">country_code</span> <span class="o">=</span> <span class="n">pc</span><span class="o">.</span><span class="n">country_name_to_country_alpha2</span><span class="p">(</span><span class="n">country_name</span><span class="p">)</span>
        <span class="n">continent</span> <span class="o">=</span> <span class="n">pc</span><span class="o">.</span><span class="n">country_alpha2_to_continent_code</span><span class="p">(</span><span class="n">country_code</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">continent</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># For countries not found or errors</span>

<span class="c1"># Apply the function to get continents</span>
<span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;Continent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;Country Name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_continent</span><span class="p">)</span>

<span class="n">continent_full_names</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;AF&#39;</span><span class="p">:</span> <span class="s1">&#39;Africa&#39;</span><span class="p">,</span>
    <span class="s1">&#39;AS&#39;</span><span class="p">:</span> <span class="s1">&#39;Asia&#39;</span><span class="p">,</span>
    <span class="s1">&#39;EU&#39;</span><span class="p">:</span> <span class="s1">&#39;Europe&#39;</span><span class="p">,</span>
    <span class="s1">&#39;NA&#39;</span><span class="p">:</span> <span class="s1">&#39;North America&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SA&#39;</span><span class="p">:</span> <span class="s1">&#39;South America&#39;</span><span class="p">,</span>
    <span class="s1">&#39;OC&#39;</span><span class="p">:</span> <span class="s1">&#39;Oceania&#39;</span>
<span class="p">}</span>

<span class="c1"># Replace continent abbreviations with full names</span>
<span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;Continent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;Continent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">continent_full_names</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;Continent&#39;</span><span class="p">])</span>

<span class="c1"># Define a color mapping for each continent</span>
<span class="n">continent_colors</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;Africa&#39;</span><span class="p">:</span> <span class="s1">&#39;#FFD700&#39;</span><span class="p">,</span>  <span class="c1"># Gold</span>
    <span class="s1">&#39;Asia&#39;</span><span class="p">:</span> <span class="s1">&#39;#FF4500&#39;</span><span class="p">,</span>    <span class="c1"># OrangeRed</span>
    <span class="s1">&#39;Europe&#39;</span><span class="p">:</span> <span class="s1">&#39;#4169E1&#39;</span><span class="p">,</span>  <span class="c1"># RoyalBlue</span>
    <span class="s1">&#39;North America&#39;</span><span class="p">:</span> <span class="s1">&#39;#32CD32&#39;</span><span class="p">,</span>  <span class="c1"># LimeGreen</span>
    <span class="s1">&#39;South America&#39;</span><span class="p">:</span> <span class="s1">&#39;#8A2BE2&#39;</span><span class="p">,</span>  <span class="c1"># BlueViolet</span>
    <span class="s1">&#39;Oceania&#39;</span><span class="p">:</span> <span class="s1">&#39;#FF69B4&#39;</span>   <span class="c1"># HotPink</span>
<span class="p">}</span>

<span class="c1"># Map colors to the Continent column</span>
<span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged_df</span><span class="p">[</span><span class="s1">&#39;Continent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">continent_colors</span><span class="p">)</span>

<span class="n">merged_df_cleaned</span> <span class="o">=</span> <span class="n">merged_df</span>

<span class="c1"># Display the updated dataframe</span>
<span class="nb">print</span><span class="p">(</span><span class="n">merged_df_cleaned</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="nb">len</span><span class="p">(</span><span class="n">merged_df_cleaned</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">merged_df_cleaned</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

<span class="c1"># Ensure GDP per capita is numeric after handling missing values</span>
<span class="n">merged_df_cleaned</span><span class="p">[</span><span class="s1">&#39;GDP per capita (USD)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">merged_df_cleaned</span><span class="p">[</span><span class="s1">&#39;GDP per capita (USD)&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

<span class="c1"># Check if the color column has any missing values</span>
<span class="nb">print</span><span class="p">(</span><span class="n">merged_df_cleaned</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>

<span class="c1"># If color column has missing values, fill them with a default color (for example, &#39;grey&#39;)</span>
<span class="n">merged_df_cleaned</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Apply the function to get continents</span>
<span class="n">merged_df_cleaned</span><span class="p">[</span><span class="s1">&#39;Continent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged_df_cleaned</span><span class="p">[</span><span class="s1">&#39;Country Name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">get_continent</span><span class="p">)</span>

<span class="n">continent_full_names</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;AF&#39;</span><span class="p">:</span> <span class="s1">&#39;Africa&#39;</span><span class="p">,</span>
    <span class="s1">&#39;AS&#39;</span><span class="p">:</span> <span class="s1">&#39;Asia&#39;</span><span class="p">,</span>
    <span class="s1">&#39;EU&#39;</span><span class="p">:</span> <span class="s1">&#39;Europe&#39;</span><span class="p">,</span>
    <span class="s1">&#39;NA&#39;</span><span class="p">:</span> <span class="s1">&#39;North America&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SA&#39;</span><span class="p">:</span> <span class="s1">&#39;South America&#39;</span><span class="p">,</span>
    <span class="s1">&#39;OC&#39;</span><span class="p">:</span> <span class="s1">&#39;Oceania&#39;</span>
<span class="p">}</span>

<span class="c1"># Replace continent abbreviations with full names</span>
<span class="n">merged_df_cleaned</span><span class="p">[</span><span class="s1">&#39;Continent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged_df_cleaned</span><span class="p">[</span><span class="s1">&#39;Continent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">continent_full_names</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">merged_df_cleaned</span><span class="p">[</span><span class="s1">&#39;Continent&#39;</span><span class="p">])</span>

<span class="c1"># Create a ColumnDataSource</span>
<span class="n">source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">merged_df_cleaned</span><span class="p">)</span>

<span class="c1"># Create the Bokeh plot with a larger size</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Mismanaged Plastic Waste per Capita vs. GDP per Capita, 2019&quot;</span><span class="p">,</span>
    <span class="n">x_axis_label</span><span class="o">=</span><span class="s2">&quot;GDP per capita (constant 2019 international $)&quot;</span><span class="p">,</span>
    <span class="n">y_axis_label</span><span class="o">=</span><span class="s2">&quot;Mismanaged plastic waste per capita (kg per person)&quot;</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="s2">&quot;pan,wheel_zoom,box_zoom,reset&quot;</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span>  <span class="c1"># Increased width</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">800</span>   <span class="c1"># Increased height</span>
<span class="p">)</span>


<span class="c1"># Setting the title font size</span>
<span class="n">p</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">text_font_size</span> <span class="o">=</span> <span class="s2">&quot;20pt&quot;</span>  <span class="c1"># Adjust the font size of the title</span>
<span class="n">p</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">text_font</span> <span class="o">=</span> <span class="s2">&quot;Times New Roman&quot;</span>

<span class="c1"># Add scatter plot with color based on &#39;color&#39; column</span>
<span class="n">scatter</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;GDP per capita (USD)&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Mismanaged plastic waste per capita (kg per year)&#39;</span><span class="p">,</span>
    <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span> <span class="n">legend_field</span><span class="o">=</span><span class="s1">&#39;Continent&#39;</span>
<span class="p">)</span>

<span class="c1"># Add a hover tool</span>
<span class="n">hover</span> <span class="o">=</span> <span class="n">HoverTool</span><span class="p">()</span>
<span class="n">hover</span><span class="o">.</span><span class="n">tooltips</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;Country&quot;</span><span class="p">,</span> <span class="s2">&quot;@{Country Name}&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Mismanaged Plastic Waste&quot;</span><span class="p">,</span> <span class="s2">&quot;@{Mismanaged plastic waste per capita (kg per year)}</span><span class="si">{0.0}</span><span class="s2"> kg per person&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;GDP per Capita&quot;</span><span class="p">,</span> <span class="s2">&quot;@{GDP per capita (USD)}{0,0} $&quot;</span><span class="p">)</span>
<span class="p">]</span>
<span class="n">p</span><span class="o">.</span><span class="n">add_tools</span><span class="p">(</span><span class="n">hover</span><span class="p">)</span>

<span class="c1"># Format the x-axis labels with a thousand separator and a dollar sign</span>
<span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">formatter</span> <span class="o">=</span> <span class="n">NumeralTickFormatter</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s2">&quot;0,0$&quot;</span><span class="p">)</span>

<span class="c1"># Style the plot</span>
<span class="n">p</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">text_font_size</span> <span class="o">=</span> <span class="s2">&quot;16pt&quot;</span>
<span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label_text_font_size</span> <span class="o">=</span> <span class="s2">&quot;12pt&quot;</span>
<span class="n">p</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label_text_font_size</span> <span class="o">=</span> <span class="s2">&quot;12pt&quot;</span>
<span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label_text_font_style</span> <span class="o">=</span> <span class="s1">&#39;bold&#39;</span>
<span class="n">p</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label_text_font_style</span> <span class="o">=</span> <span class="s1">&#39;bold&#39;</span>

<span class="c1"># Move the legend outside the plot and make it interactive</span>
<span class="n">p</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="s2">&quot;top_right&quot;</span>
<span class="n">p</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">orientation</span> <span class="o">=</span> <span class="s2">&quot;vertical&quot;</span>  <span class="c1"># Stack the legend items vertically</span>
<span class="n">p</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">margin</span> <span class="o">=</span> <span class="mi">20</span>  <span class="c1"># Add margin around the legend</span>

<span class="c1"># Narrative introduction</span>
<span class="n">narrative</span> <span class="o">=</span> <span class="n">Div</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">&lt;h1 style=&quot;text-align:left;&quot;&gt;Linking Prosperity and Pollution: A Paradox in Plastic Management&lt;/h1&gt;</span>
<span class="s2">&lt;p style=&quot;text-align: justify; font-size: 14px; margin-top: 10px;&quot;&gt;</span>
<span class="s2">Is economic prosperity a shield against environmental degradation, or does it amplify our ecological footprint?</span>
<span class="s2">This visualization juxtaposes GDP per capita with mismanaged plastic waste per capita across nations in 2019.</span>
<span class="s2">Each point represents a country, its color encoding the continent it belongs to.&lt;br&gt;&lt;br&gt;</span>
<span class="s2">While richer nations cluster towards the lower right—indicating lower mismanaged waste—poorer countries often</span>
<span class="s2">appear higher on the y-axis, exposing vulnerabilities in waste management infrastructure.</span>
<span class="s2">Yet, exceptions abound, challenging assumptions and hinting at cultural, policy, and geographic nuances.&lt;br&gt;&lt;br&gt;</span>
<span class="s2">This plot invites you to navigate the complexities of affluence and accountability.</span>
<span class="s2">How can nations break free from this paradox to harmonize growth with stewardship?</span>
<span class="s2">&lt;/p&gt;</span>
<span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>

<span class="c1"># Combine narrative and plot</span>
<span class="n">layout4</span> <span class="o">=</span> <span class="n">column</span><span class="p">(</span><span class="n">narrative</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="c1">#show(layout)</span>
<span class="c1">#pn.serve(layout)</span>



<span class="c1"># Show the plot</span>
<span class="c1">#show(p)</span>

<span class="n">data6</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/Users/sanyuktatuti/downloads/st5442_Assignment4/waste-items-ocean-region.csv&#39;</span><span class="p">)</span> <span class="c1">#the path needs to be inserted accordingly to recreate visualization</span>

<span class="n">df6</span> <span class="o">=</span> <span class="n">data6</span>

<span class="n">df6</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

<span class="c1"># Add narrative text at the top</span>
<span class="n">main_title</span> <span class="o">=</span> <span class="n">Div</span><span class="p">(</span>
    <span class="n">text</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    &lt;h1 style=&#39;text-align: left;&#39;&gt;Unveiling the Plastic Menace: A Regional Analysis of Ocean Waste&lt;/h1&gt;</span>
<span class="s2">&lt;p style=&quot;text-align: justify; font-size: 14px; margin-top: 10px;&quot;&gt;</span>
<span class="s2">    Plastic pollution has become an omnipresent threat to marine ecosystems. This visualization highlights the top waste items by region, illustrating how consumption habits, waste management practices, and socioeconomic factors manifest uniquely across the globe.</span>

<span class="s2">Each chart reveals the top 10 plastic items found in oceans for a specific region. The horizontal bars quantify their prevalence, while the adjacent labels provide percentages for clarity. By juxtaposing these trends, we can uncover patterns and anomalies—such as which regions grapple with certain waste items more than others—and identify focal points for global cleanup and prevention efforts.</span>

<span class="s2">Dive into the data to uncover the untold story of plastic waste across our oceans.</span>
<span class="s2">    &lt;/p&gt;</span>
<span class="s2">    &quot;&quot;&quot;</span><span class="p">)</span>

<span class="n">plots</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Melt the dataset into long format</span>
<span class="n">data_melted</span> <span class="o">=</span> <span class="n">data6</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span>
    <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Entity&quot;</span><span class="p">,</span> <span class="s2">&quot;Code&quot;</span><span class="p">,</span> <span class="s2">&quot;Year&quot;</span><span class="p">],</span>
    <span class="n">var_name</span><span class="o">=</span><span class="s2">&quot;Region&quot;</span><span class="p">,</span>
    <span class="n">value_name</span><span class="o">=</span><span class="s2">&quot;Percentage&quot;</span>
<span class="p">)</span>

<span class="c1"># Drop rows with NaN percentages</span>
<span class="n">data_melted</span> <span class="o">=</span> <span class="n">data_melted</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Percentage&quot;</span><span class="p">])</span>

<span class="c1"># Initialize a list to store the individual region plots</span>
<span class="n">plots</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Get unique regions</span>
<span class="n">regions</span> <span class="o">=</span> <span class="n">data_melted</span><span class="p">[</span><span class="s1">&#39;Region&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>


<span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">regions</span><span class="p">:</span>
    <span class="n">region_data</span> <span class="o">=</span> <span class="n">data_melted</span><span class="p">[</span><span class="n">data_melted</span><span class="p">[</span><span class="s1">&#39;Region&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">region</span><span class="p">]</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;Percentage&quot;</span><span class="p">)</span>
    <span class="n">region_data</span><span class="p">[</span><span class="s2">&quot;PercentageLabel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">region_data</span><span class="p">[</span><span class="s2">&quot;Percentage&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;%&quot;</span>

    <span class="n">source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">items</span><span class="o">=</span><span class="n">region_data</span><span class="p">[</span><span class="s1">&#39;Entity&#39;</span><span class="p">],</span>
        <span class="n">percentages</span><span class="o">=</span><span class="n">region_data</span><span class="p">[</span><span class="s1">&#39;Percentage&#39;</span><span class="p">],</span>
        <span class="n">labels</span><span class="o">=</span><span class="n">region_data</span><span class="p">[</span><span class="s1">&#39;PercentageLabel&#39;</span><span class="p">]</span>
    <span class="p">))</span>

    <span class="c1"># Create figure</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span>
        <span class="n">y_range</span><span class="o">=</span><span class="n">region_data</span><span class="p">[</span><span class="s1">&#39;Entity&#39;</span><span class="p">],</span>
        <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">region</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">tools</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">toolbar_location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="mi">700</span>
    <span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">hbar</span><span class="p">(</span>
        <span class="n">y</span><span class="o">=</span><span class="s2">&quot;items&quot;</span><span class="p">,</span>
        <span class="n">right</span><span class="o">=</span><span class="s2">&quot;percentages&quot;</span><span class="p">,</span>
        <span class="n">height</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#718dbf&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Add hover tool</span>
    <span class="n">hover</span> <span class="o">=</span> <span class="n">HoverTool</span><span class="p">()</span>
    <span class="n">hover</span><span class="o">.</span><span class="n">tooltips</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;Item&quot;</span><span class="p">,</span> <span class="s2">&quot;@items&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Percentage&quot;</span><span class="p">,</span> <span class="s2">&quot;@percentages</span><span class="si">{0.0}</span><span class="s2">%&quot;</span><span class="p">)</span>
    <span class="p">]</span>
    <span class="n">p</span><span class="o">.</span><span class="n">add_tools</span><span class="p">(</span><span class="n">hover</span><span class="p">)</span>

    <span class="c1"># Configure labels</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">LabelSet</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="s1">&#39;percentages&#39;</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="s1">&#39;items&#39;</span><span class="p">,</span>
        <span class="n">text</span><span class="o">=</span><span class="s1">&#39;labels&#39;</span><span class="p">,</span>
        <span class="n">x_offset</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">text_font_size</span><span class="o">=</span><span class="s2">&quot;10pt&quot;</span><span class="p">,</span>
        <span class="n">source</span><span class="o">=</span><span class="n">source</span>
    <span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>

    <span class="c1"># Style plot</span>
    <span class="n">p</span><span class="o">.</span><span class="n">x_range</span><span class="o">.</span><span class="n">end</span> <span class="o">=</span> <span class="n">region_data</span><span class="p">[</span><span class="s1">&#39;Percentage&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">5</span>
    <span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s2">&quot;Percentage&quot;</span>
    <span class="n">p</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s2">&quot;Waste Items&quot;</span>
    <span class="n">p</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">text_font_size</span> <span class="o">=</span> <span class="s2">&quot;14pt&quot;</span>
    <span class="n">p</span><span class="o">.</span><span class="n">xgrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">p</span><span class="o">.</span><span class="n">ygrid</span><span class="o">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">plots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>


<span class="c1"># Arrange plots</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">gridplot</span><span class="p">([</span><span class="n">plots</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">plots</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="n">plots</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">]])</span>
<span class="n">layout5</span> <span class="o">=</span> <span class="n">column</span><span class="p">(</span><span class="n">main_title</span><span class="p">,</span> <span class="n">grid</span><span class="p">)</span>

<span class="c1"># Show layout</span>
<span class="c1">#show(layout)</span>
<span class="c1">#pn.serve(layout)</span>

<span class="c1"># Conclusion text</span>
<span class="n">conclusion</span> <span class="o">=</span> <span class="n">Div</span><span class="p">(</span>
    <span class="n">text</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    &lt;h1 style=&quot;text-align:center;&quot;&gt;Paving the Way for Change&lt;/h1&gt;</span>
<span class="s2">&lt;p style=&quot;text-align: justify; font-size: 14px; margin-top: 10px;&quot;&gt;</span>
<span class="s2">        The visualizations reveal stark disparities in plastic waste generation and management worldwide.</span>
<span class="s2">        Wealthier nations often exhibit lower levels of mismanaged waste, yet they contribute significantly to global</span>
<span class="s2">        consumption. Conversely, economically vulnerable regions face the brunt of mismanagement, underscoring systemic</span>
<span class="s2">        inequalities in waste infrastructure and policy.</span>
<span class="s2">    &lt;/p&gt;</span>
<span class="s2">&lt;p style=&quot;text-align: justify; font-size: 14px; margin-top: 10px;&quot;&gt;</span>
<span class="s2">        In the oceans, we see the consequences of human behavior laid bare: specific regions contend with distinct</span>
<span class="s2">        waste types, reflecting consumption patterns and regional dynamics. Addressing this crisis requires global</span>
<span class="s2">        cooperation, targeted policy interventions, and a commitment to sustainability across all sectors of society.</span>
<span class="s2">    &lt;/p&gt;</span>
<span class="s2">&lt;p style=&quot;text-align: justify; font-size: 14px; margin-top: 10px;&quot;&gt;</span>
<span class="s2">        These visualizations serve as a call to action—empowering individuals, organizations, and policymakers to</span>
<span class="s2">        understand the problem and take informed steps toward a cleaner, healthier planet.</span>
<span class="s2">    &lt;/p&gt;</span>
<span class="s2">    &quot;&quot;&quot;</span>
<span class="p">)</span>

<span class="n">combined_layout</span> <span class="o">=</span> <span class="n">column</span><span class="p">(</span>
    <span class="n">layout1</span><span class="p">,</span>  <span class="c1"># First visualization</span>
    <span class="n">layout2</span><span class="p">,</span>  <span class="c1"># Second visualization</span>
    <span class="n">layout3</span><span class="p">,</span>  <span class="c1"># Third visualization</span>
    <span class="n">layout4</span><span class="p">,</span>
    <span class="n">layout5</span><span class="p">,</span>
    <span class="n">conclusion</span><span class="p">,</span>
    <span class="n">sizing_mode</span><span class="o">=</span><span class="s2">&quot;stretch_width&quot;</span>
<span class="p">)</span>

<span class="c1">#full_layout = column(combined_layout, conclusion, sizing_mode = &quot;stretch_width&quot;)</span>

<span class="c1">#full_layout.align = &#39;center&#39;</span>

<span class="n">pn</span><span class="o">.</span><span class="n">serve</span><span class="p">(</span><span class="n">combined_layout</span><span class="p">)</span>
</pre></div>

<div class="highlight"><pre>
BokehDeprecationWarning: &#39;circle() method with size value&#39; was
deprecated in Bokeh 3.4.0 and will be removed, use
&#39;scatter(size=...) instead&#39; instead.
Number of rows: 132
          Country Name  Mismanaged plastic waste per capita (kg per
year)  \
0              Albania
24.239153
1              Algeria
17.758995
2               Angola
7.445279
3  Antigua and Barbuda
6.463918
4            Argentina
10.401912
5            Australia
0.208943
6              Bahrain
0.635588
7           Bangladesh
6.268108
8             Barbados
3.038328
9              Belgium
0.197937

  GDP per capita (USD)      Continent    color
0     14617.7849093704         Europe  #4169E1
1     14084.1995307289         Africa  #FFD700
2     7533.51185400503         Africa  #FFD700
3      26316.833216636  North America  #32CD32
4       23535.01275094  South America  #8A2BE2
5     52746.7182896307        Oceania  #FF69B4
6     53712.1485212388           Asia  #FF4500
7     6025.08734934947           Asia  #FF4500
8     17459.1512630062  North America  #32CD32
9     56621.5417607532         Europe  #4169E1
Index([&#39;Country Name&#39;, &#39;Mismanaged plastic waste per
capita (kg per year)&#39;,
       &#39;GDP per capita (USD)&#39;, &#39;Continent&#39;,
&#39;color&#39;],
      dtype=&#39;object&#39;)
3
Launching server at http://localhost:56375
/var/folders/dv/7swn0_8d5434v2xwcvtw_vsc0000gn/T/ipykernel_87040/3862590227.py:632:
FutureWarning: A value is trying to be set on a copy of a DataFrame or
Series through chained assignment using an inplace method.
The behavior will change in pandas 3.0. This inplace method will never
work because the intermediate object on which we are setting values
always behaves as a copy.

For example, when doing &#39;df[col].method(value, inplace=True)&#39;,
try using &#39;df.method({col: value}, inplace=True)&#39; or df[col] =
df[col].method(value) instead, to perform the operation inplace on the
original object.


  merged_df_cleaned[&#39;color&#39;].fillna(&#39;grey&#39;,
inplace=True)
</pre></div>

<script type="esms-options">{"shimMode": true}</script><style>*[data-root-id],
*[data-root-id] > * {
  box-sizing: border-box;
  font-family: var(--jp-ui-font-family);
  font-size: var(--jp-ui-font-size1);
  color: var(--vscode-editor-foreground, var(--jp-ui-font-color1));
}

/* Override VSCode background color */
.cell-output-ipywidget-background:has(
    > .cell-output-ipywidget-background > .lm-Widget > *[data-root-id]
  ),
.cell-output-ipywidget-background:has(> .lm-Widget > *[data-root-id]) {
  background-color: transparent !important;
}
</style>
<script>(function(root) {
  function now() {
    return new Date();
  }

  const force = true;
  const py_version = '3.6.0'.replace('rc', '-rc.').replace('.dev', '-dev.');
  const reloading = false;
  const Bokeh = root.Bokeh;

  // Set a timeout for this load but only if we are not already initializing
  if (typeof (root._bokeh_timeout) === "undefined" || (force || !root._bokeh_is_initializing)) {
    root._bokeh_timeout = Date.now() + 5000;
    root._bokeh_failed_load = false;
  }

  function run_callbacks() {
    try {
      root._bokeh_onload_callbacks.forEach(function(callback) {
        if (callback != null)
          callback();
      });
    } finally {
      delete root._bokeh_onload_callbacks;
    }
    console.debug("Bokeh: all callbacks have finished");
  }

  function load_libs(css_urls, js_urls, js_modules, js_exports, callback) {
    if (css_urls == null) css_urls = [];
    if (js_urls == null) js_urls = [];
    if (js_modules == null) js_modules = [];
    if (js_exports == null) js_exports = {};

    root._bokeh_onload_callbacks.push(callback);

    if (root._bokeh_is_loading > 0) {
      // Don't load bokeh if it is still initializing
      console.debug("Bokeh: BokehJS is being loaded, scheduling callback at", now());
      return null;
    } else if (js_urls.length === 0 && js_modules.length === 0 && Object.keys(js_exports).length === 0) {
      // There is nothing to load
      run_callbacks();
      return null;
    }

    function on_load() {
      root._bokeh_is_loading--;
      if (root._bokeh_is_loading === 0) {
        console.debug("Bokeh: all BokehJS libraries/stylesheets loaded");
        run_callbacks()
      }
    }
    window._bokeh_on_load = on_load

    function on_error(e) {
      const src_el = e.srcElement
      console.error("failed to load " + (src_el.href || src_el.src));
    }

    const skip = [];
    if (window.requirejs) {
      window.requirejs.config({'packages': {}, 'paths': {}, 'shim': {}});
      root._bokeh_is_loading = css_urls.length + 0;
    } else {
      root._bokeh_is_loading = css_urls.length + js_urls.length + js_modules.length + Object.keys(js_exports).length;
    }

    const existing_stylesheets = []
    const links = document.getElementsByTagName('link')
    for (let i = 0; i < links.length; i++) {
      const link = links[i]
      if (link.href != null) {
        existing_stylesheets.push(link.href)
      }
    }
    for (let i = 0; i < css_urls.length; i++) {
      const url = css_urls[i];
      const escaped = encodeURI(url)
      if (existing_stylesheets.indexOf(escaped) !== -1) {
        on_load()
        continue;
      }
      const element = document.createElement("link");
      element.onload = on_load;
      element.onerror = on_error;
      element.rel = "stylesheet";
      element.type = "text/css";
      element.href = url;
      console.debug("Bokeh: injecting link tag for BokehJS stylesheet: ", url);
      document.body.appendChild(element);
    }    var existing_scripts = []
    const scripts = document.getElementsByTagName('script')
    for (let i = 0; i < scripts.length; i++) {
      var script = scripts[i]
      if (script.src != null) {
        existing_scripts.push(script.src)
      }
    }
    for (let i = 0; i < js_urls.length; i++) {
      const url = js_urls[i];
      const escaped = encodeURI(url)
      if (skip.indexOf(escaped) !== -1 || existing_scripts.indexOf(escaped) !== -1) {
        if (!window.requirejs) {
          on_load();
        }
        continue;
      }
      const element = document.createElement('script');
      element.onload = on_load;
      element.onerror = on_error;
      element.async = false;
      element.src = url;
      console.debug("Bokeh: injecting script tag for BokehJS library: ", url);
      document.head.appendChild(element);
    }
    for (let i = 0; i < js_modules.length; i++) {
      const url = js_modules[i];
      const escaped = encodeURI(url)
      if (skip.indexOf(escaped) !== -1 || existing_scripts.indexOf(escaped) !== -1) {
        if (!window.requirejs) {
          on_load();
        }
        continue;
      }
      var element = document.createElement('script');
      element.onload = on_load;
      element.onerror = on_error;
      element.async = false;
      element.src = url;
      element.type = "module";
      console.debug("Bokeh: injecting script tag for BokehJS library: ", url);
      document.head.appendChild(element);
    }
    for (const name in js_exports) {
      const url = js_exports[name];
      const escaped = encodeURI(url)
      if (skip.indexOf(escaped) >= 0 || root[name] != null) {
        if (!window.requirejs) {
          on_load();
        }
        continue;
      }
      var element = document.createElement('script');
      element.onerror = on_error;
      element.async = false;
      element.type = "module";
      console.debug("Bokeh: injecting script tag for BokehJS library: ", url);
      element.textContent = `
      import ${name} from "${url}"
      window.${name} = ${name}
      window._bokeh_on_load()
      `
      document.head.appendChild(element);
    }
    if (!js_urls.length && !js_modules.length) {
      on_load()
    }
  };

  function inject_raw_css(css) {
    const element = document.createElement("style");
    element.appendChild(document.createTextNode(css));
    document.body.appendChild(element);
  }

  const js_urls = ["https://cdn.holoviz.org/panel/1.5.3/dist/bundled/reactiveesm/es-module-shims@^1.10.0/dist/es-module-shims.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-3.6.0.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-gl-3.6.0.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-widgets-3.6.0.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-tables-3.6.0.min.js", "https://cdn.holoviz.org/panel/1.5.3/dist/panel.min.js"];
  const js_modules = [];
  const js_exports = {};
  const css_urls = [];
  const inline_js = [    function(Bokeh) {
      Bokeh.set_log_level("info");
    },
function(Bokeh) {} // ensure no trailing comma for IE
  ];

  function run_inline_js() {
    if ((root.Bokeh !== undefined) || (force === true)) {
      for (let i = 0; i < inline_js.length; i++) {
        try {
          inline_js[i].call(root, root.Bokeh);
        } catch(e) {
          if (!reloading) {
            throw e;
          }
        }
      }
      // Cache old bokeh versions
      if (Bokeh != undefined && !reloading) {
        var NewBokeh = root.Bokeh;
        if (Bokeh.versions === undefined) {
          Bokeh.versions = new Map();
        }
        if (NewBokeh.version !== Bokeh.version) {
          Bokeh.versions.set(NewBokeh.version, NewBokeh)
        }
        root.Bokeh = Bokeh;
      }
    } else if (Date.now() < root._bokeh_timeout) {
      setTimeout(run_inline_js, 100);
    } else if (!root._bokeh_failed_load) {
      console.log("Bokeh: BokehJS failed to load within specified timeout.");
      root._bokeh_failed_load = true;
    }
    root._bokeh_is_initializing = false
  }

  function load_or_wait() {
    // Implement a backoff loop that tries to ensure we do not load multiple
    // versions of Bokeh and its dependencies at the same time.
    // In recent versions we use the root._bokeh_is_initializing flag
    // to determine whether there is an ongoing attempt to initialize
    // bokeh, however for backward compatibility we also try to ensure
    // that we do not start loading a newer (Panel>=1.0 and Bokeh>3) version
    // before older versions are fully initialized.
    if (root._bokeh_is_initializing && Date.now() > root._bokeh_timeout) {
      // If the timeout and bokeh was not successfully loaded we reset
      // everything and try loading again
      root._bokeh_timeout = Date.now() + 5000;
      root._bokeh_is_initializing = false;
      root._bokeh_onload_callbacks = undefined;
      root._bokeh_is_loading = 0
      console.log("Bokeh: BokehJS was loaded multiple times but one version failed to initialize.");
      load_or_wait();
    } else if (root._bokeh_is_initializing || (typeof root._bokeh_is_initializing === "undefined" && root._bokeh_onload_callbacks !== undefined)) {
      setTimeout(load_or_wait, 100);
    } else {
      root._bokeh_is_initializing = true
      root._bokeh_onload_callbacks = []
      const bokeh_loaded = root.Bokeh != null && (root.Bokeh.version === py_version || (root.Bokeh.versions !== undefined && root.Bokeh.versions.has(py_version)));
      if (!reloading && !bokeh_loaded) {
        if (root.Bokeh) {
          root.Bokeh = undefined;
        }
        console.debug("Bokeh: BokehJS not loaded, scheduling load and callback at", now());
      }
      load_libs(css_urls, js_urls, js_modules, js_exports, function() {
        console.debug("Bokeh: BokehJS plotting callback run at", now());
        run_inline_js();
      });
    }
  }
  // Give older versions of the autoload script a head-start to ensure
  // they initialize before we start loading newer version.
  setTimeout(load_or_wait, 100)
}(window));</script>
<script>
if ((window.PyViz === undefined) || (window.PyViz instanceof HTMLElement)) {
  window.PyViz = {comms: {}, comm_status:{}, kernels:{}, receivers: {}, plot_index: []}
}


    function JupyterCommManager() {
    }

    JupyterCommManager.prototype.register_target = function(plot_id, comm_id, msg_handler) {
      if (window.comm_manager || ((window.Jupyter !== undefined) && (Jupyter.notebook.kernel != null))) {
        var comm_manager = window.comm_manager || Jupyter.notebook.kernel.comm_manager;
        comm_manager.register_target(comm_id, function(comm) {
          comm.on_msg(msg_handler);
        });
      } else if ((plot_id in window.PyViz.kernels) && (window.PyViz.kernels[plot_id])) {
        window.PyViz.kernels[plot_id].registerCommTarget(comm_id, function(comm) {
          comm.onMsg = msg_handler;
        });
      } else if (typeof google != 'undefined' && google.colab.kernel != null) {
        google.colab.kernel.comms.registerTarget(comm_id, (comm) => {
          var messages = comm.messages[Symbol.asyncIterator]();
          function processIteratorResult(result) {
            var message = result.value;
            console.log(message)
            var content = {data: message.data, comm_id};
            var buffers = []
            for (var buffer of message.buffers || []) {
              buffers.push(new DataView(buffer))
            }
            var metadata = message.metadata || {};
            var msg = {content, buffers, metadata}
            msg_handler(msg);
            return messages.next().then(processIteratorResult);
          }
          return messages.next().then(processIteratorResult);
        })
      }
    }

    JupyterCommManager.prototype.get_client_comm = function(plot_id, comm_id, msg_handler) {
      if (comm_id in window.PyViz.comms) {
        return window.PyViz.comms[comm_id];
      } else if (window.comm_manager || ((window.Jupyter !== undefined) && (Jupyter.notebook.kernel != null))) {
        var comm_manager = window.comm_manager || Jupyter.notebook.kernel.comm_manager;
        var comm = comm_manager.new_comm(comm_id, {}, {}, {}, comm_id);
        if (msg_handler) {
          comm.on_msg(msg_handler);
        }
      } else if ((plot_id in window.PyViz.kernels) && (window.PyViz.kernels[plot_id])) {
        var comm = window.PyViz.kernels[plot_id].connectToComm(comm_id);
        comm.open();
        if (msg_handler) {
          comm.onMsg = msg_handler;
        }
      } else if (typeof google != 'undefined' && google.colab.kernel != null) {
        var comm_promise = google.colab.kernel.comms.open(comm_id)
        comm_promise.then((comm) => {
          window.PyViz.comms[comm_id] = comm;
          if (msg_handler) {
            var messages = comm.messages[Symbol.asyncIterator]();
            function processIteratorResult(result) {
              var message = result.value;
              var content = {data: message.data};
              var metadata = message.metadata || {comm_id};
              var msg = {content, metadata}
              msg_handler(msg);
              return messages.next().then(processIteratorResult);
            }
            return messages.next().then(processIteratorResult);
          }
        }) 
        var sendClosure = (data, metadata, buffers, disposeOnDone) => {
          return comm_promise.then((comm) => {
            comm.send(data, metadata, buffers, disposeOnDone);
          });
        };
        var comm = {
          send: sendClosure
        };
      }
      window.PyViz.comms[comm_id] = comm;
      return comm;
    }
    window.PyViz.comm_manager = new JupyterCommManager();
    


var JS_MIME_TYPE = 'application/javascript';
var HTML_MIME_TYPE = 'text/html';
var EXEC_MIME_TYPE = 'application/vnd.holoviews_exec.v0+json';
var CLASS_NAME = 'output';

/**
 * Render data to the DOM node
 */
function render(props, node) {
  var div = document.createElement("div");
  var script = document.createElement("script");
  node.appendChild(div);
  node.appendChild(script);
}

/**
 * Handle when a new output is added
 */
function handle_add_output(event, handle) {
  var output_area = handle.output_area;
  var output = handle.output;
  if ((output.data == undefined) || (!output.data.hasOwnProperty(EXEC_MIME_TYPE))) {
    return
  }
  var id = output.metadata[EXEC_MIME_TYPE]["id"];
  var toinsert = output_area.element.find("." + CLASS_NAME.split(' ')[0]);
  if (id !== undefined) {
    var nchildren = toinsert.length;
    var html_node = toinsert[nchildren-1].children[0];
    html_node.innerHTML = output.data[HTML_MIME_TYPE];
    var scripts = [];
    var nodelist = html_node.querySelectorAll("script");
    for (var i in nodelist) {
      if (nodelist.hasOwnProperty(i)) {
        scripts.push(nodelist[i])
      }
    }

    scripts.forEach( function (oldScript) {
      var newScript = document.createElement("script");
      var attrs = [];
      var nodemap = oldScript.attributes;
      for (var j in nodemap) {
        if (nodemap.hasOwnProperty(j)) {
          attrs.push(nodemap[j])
        }
      }
      attrs.forEach(function(attr) { newScript.setAttribute(attr.name, attr.value) });
      newScript.appendChild(document.createTextNode(oldScript.innerHTML));
      oldScript.parentNode.replaceChild(newScript, oldScript);
    });
    if (JS_MIME_TYPE in output.data) {
      toinsert[nchildren-1].children[1].textContent = output.data[JS_MIME_TYPE];
    }
    output_area._hv_plot_id = id;
    if ((window.Bokeh !== undefined) && (id in Bokeh.index)) {
      window.PyViz.plot_index[id] = Bokeh.index[id];
    } else {
      window.PyViz.plot_index[id] = null;
    }
  } else if (output.metadata[EXEC_MIME_TYPE]["server_id"] !== undefined) {
    var bk_div = document.createElement("div");
    bk_div.innerHTML = output.data[HTML_MIME_TYPE];
    var script_attrs = bk_div.children[0].attributes;
    for (var i = 0; i < script_attrs.length; i++) {
      toinsert[toinsert.length - 1].childNodes[1].setAttribute(script_attrs[i].name, script_attrs[i].value);
    }
    // store reference to server id on output_area
    output_area._bokeh_server_id = output.metadata[EXEC_MIME_TYPE]["server_id"];
  }
}

/**
 * Handle when an output is cleared or removed
 */
function handle_clear_output(event, handle) {
  var id = handle.cell.output_area._hv_plot_id;
  var server_id = handle.cell.output_area._bokeh_server_id;
  if (((id === undefined) || !(id in PyViz.plot_index)) && (server_id !== undefined)) { return; }
  var comm = window.PyViz.comm_manager.get_client_comm("hv-extension-comm", "hv-extension-comm", function () {});
  if (server_id !== null) {
    comm.send({event_type: 'server_delete', 'id': server_id});
    return;
  } else if (comm !== null) {
    comm.send({event_type: 'delete', 'id': id});
  }
  delete PyViz.plot_index[id];
  if ((window.Bokeh !== undefined) & (id in window.Bokeh.index)) {
    var doc = window.Bokeh.index[id].model.document
    doc.clear();
    const i = window.Bokeh.documents.indexOf(doc);
    if (i > -1) {
      window.Bokeh.documents.splice(i, 1);
    }
  }
}

/**
 * Handle kernel restart event
 */
function handle_kernel_cleanup(event, handle) {
  delete PyViz.comms["hv-extension-comm"];
  window.PyViz.plot_index = {}
}

/**
 * Handle update_display_data messages
 */
function handle_update_output(event, handle) {
  handle_clear_output(event, {cell: {output_area: handle.output_area}})
  handle_add_output(event, handle)
}

function register_renderer(events, OutputArea) {
  function append_mime(data, metadata, element) {
    // create a DOM node to render to
    var toinsert = this.create_output_subarea(
    metadata,
    CLASS_NAME,
    EXEC_MIME_TYPE
    );
    this.keyboard_manager.register_events(toinsert);
    // Render to node
    var props = {data: data, metadata: metadata[EXEC_MIME_TYPE]};
    render(props, toinsert[0]);
    element.append(toinsert);
    return toinsert
  }

  events.on('output_added.OutputArea', handle_add_output);
  events.on('output_updated.OutputArea', handle_update_output);
  events.on('clear_output.CodeCell', handle_clear_output);
  events.on('delete.Cell', handle_clear_output);
  events.on('kernel_ready.Kernel', handle_kernel_cleanup);

  OutputArea.prototype.register_mime_type(EXEC_MIME_TYPE, append_mime, {
    safe: true,
    index: 0
  });
}

if (window.Jupyter !== undefined) {
  try {
    var events = require('base/js/events');
    var OutputArea = require('notebook/js/outputarea').OutputArea;
    if (OutputArea.prototype.mime_types().indexOf(EXEC_MIME_TYPE) == -1) {
      register_renderer(events, OutputArea);
    }
  } catch(err) {
  }
}
</script>
<div id='31d52fd1-c137-4a17-a134-b92e07758018'>
  <div id="efedfb52-e1f3-4958-8d59-4775078b1e18" data-root-id="31d52fd1-c137-4a17-a134-b92e07758018" style="display: contents;"></div>
</div>
<script type="application/javascript">(function(root) {
  var docs_json = {"620a1171-dcf0-4a50-9496-4ebf116250ef":{"version":"3.6.0","title":"Bokeh Application","roots":[{"type":"object","name":"panel.models.browser.BrowserInfo","id":"31d52fd1-c137-4a17-a134-b92e07758018"},{"type":"object","name":"panel.models.comm_manager.CommManager","id":"5052115c-7f0c-4c16-95a2-77a1f64d9ea2","attributes":{"plot_id":"31d52fd1-c137-4a17-a134-b92e07758018","comm_id":"e329f84f4d884af0a7aa2374e8c8c06b","client_comm_id":"184fb34414ae4aa2bde46faead35d1c2"}}],"defs":[{"type":"model","name":"ReactiveHTML1"},{"type":"model","name":"FlexBox1","properties":[{"name":"align_content","kind":"Any","default":"flex-start"},{"name":"align_items","kind":"Any","default":"flex-start"},{"name":"flex_direction","kind":"Any","default":"row"},{"name":"flex_wrap","kind":"Any","default":"wrap"},{"name":"gap","kind":"Any","default":""},{"name":"justify_content","kind":"Any","default":"flex-start"}]},{"type":"model","name":"FloatPanel1","properties":[{"name":"config","kind":"Any","default":{"type":"map"}},{"name":"contained","kind":"Any","default":true},{"name":"position","kind":"Any","default":"right-top"},{"name":"offsetx","kind":"Any","default":null},{"name":"offsety","kind":"Any","default":null},{"name":"theme","kind":"Any","default":"primary"},{"name":"status","kind":"Any","default":"normalized"}]},{"type":"model","name":"GridStack1","properties":[{"name":"mode","kind":"Any","default":"warn"},{"name":"ncols","kind":"Any","default":null},{"name":"nrows","kind":"Any","default":null},{"name":"allow_resize","kind":"Any","default":true},{"name":"allow_drag","kind":"Any","default":true},{"name":"state","kind":"Any","default":[]}]},{"type":"model","name":"drag1","properties":[{"name":"slider_width","kind":"Any","default":5},{"name":"slider_color","kind":"Any","default":"black"},{"name":"value","kind":"Any","default":50}]},{"type":"model","name":"click1","properties":[{"name":"terminal_output","kind":"Any","default":""},{"name":"debug_name","kind":"Any","default":""},{"name":"clears","kind":"Any","default":0}]},{"type":"model","name":"FastWrapper1","properties":[{"name":"object","kind":"Any","default":null},{"name":"style","kind":"Any","default":null}]},{"type":"model","name":"NotificationAreaBase1","properties":[{"name":"js_events","kind":"Any","default":{"type":"map"}},{"name":"position","kind":"Any","default":"bottom-right"},{"name":"_clear","kind":"Any","default":0}]},{"type":"model","name":"NotificationArea1","properties":[{"name":"js_events","kind":"Any","default":{"type":"map"}},{"name":"notifications","kind":"Any","default":[]},{"name":"position","kind":"Any","default":"bottom-right"},{"name":"_clear","kind":"Any","default":0},{"name":"types","kind":"Any","default":[{"type":"map","entries":[["type","warning"],["background","#ffc107"],["icon",{"type":"map","entries":[["className","fas fa-exclamation-triangle"],["tagName","i"],["color","white"]]}]]},{"type":"map","entries":[["type","info"],["background","#007bff"],["icon",{"type":"map","entries":[["className","fas fa-info-circle"],["tagName","i"],["color","white"]]}]]}]}]},{"type":"model","name":"Notification","properties":[{"name":"background","kind":"Any","default":null},{"name":"duration","kind":"Any","default":3000},{"name":"icon","kind":"Any","default":null},{"name":"message","kind":"Any","default":""},{"name":"notification_type","kind":"Any","default":null},{"name":"_destroyed","kind":"Any","default":false}]},{"type":"model","name":"TemplateActions1","properties":[{"name":"open_modal","kind":"Any","default":0},{"name":"close_modal","kind":"Any","default":0}]},{"type":"model","name":"BootstrapTemplateActions1","properties":[{"name":"open_modal","kind":"Any","default":0},{"name":"close_modal","kind":"Any","default":0}]},{"type":"model","name":"TemplateEditor1","properties":[{"name":"layout","kind":"Any","default":[]}]},{"type":"model","name":"MaterialTemplateActions1","properties":[{"name":"open_modal","kind":"Any","default":0},{"name":"close_modal","kind":"Any","default":0}]},{"type":"model","name":"ReactiveESM1"},{"type":"model","name":"JSComponent1"},{"type":"model","name":"ReactComponent1"},{"type":"model","name":"AnyWidgetComponent1"},{"type":"model","name":"request_value1","properties":[{"name":"fill","kind":"Any","default":"none"},{"name":"_synced","kind":"Any","default":null},{"name":"_request_sync","kind":"Any","default":0}]}]}};
  var render_items = [{"docid":"620a1171-dcf0-4a50-9496-4ebf116250ef","roots":{"31d52fd1-c137-4a17-a134-b92e07758018":"efedfb52-e1f3-4958-8d59-4775078b1e18"},"root_ids":["31d52fd1-c137-4a17-a134-b92e07758018"]}];
  var docs = Object.values(docs_json)
  if (!docs) {
    return
  }
  const py_version = docs[0].version.replace('rc', '-rc.').replace('.dev', '-dev.')
  async function embed_document(root) {
    var Bokeh = get_bokeh(root)
    await Bokeh.embed.embed_items_notebook(docs_json, render_items);
    for (const render_item of render_items) {
      for (const root_id of render_item.root_ids) {
	const id_el = document.getElementById(root_id)
	if (id_el.children.length && id_el.children[0].hasAttribute('data-root-id')) {
	  const root_el = id_el.children[0]
	  root_el.id = root_el.id + '-rendered'
	  for (const child of root_el.children) {
            // Ensure JupyterLab does not capture keyboard shortcuts
            // see: https://jupyterlab.readthedocs.io/en/4.1.x/extension/notebook.html#keyboard-interaction-model
	    child.setAttribute('data-lm-suppress-shortcuts', 'true')
	  }
	}
      }
    }
  }
  function get_bokeh(root) {
    if (root.Bokeh === undefined) {
      return null
    } else if (root.Bokeh.version !== py_version) {
      if (root.Bokeh.versions === undefined || !root.Bokeh.versions.has(py_version)) {
	return null
      }
      return root.Bokeh.versions.get(py_version);
    } else if (root.Bokeh.version === py_version) {
      return root.Bokeh
    }
    return null
  }
  function is_loaded(root) {
    var Bokeh = get_bokeh(root)
    return (Bokeh != null && Bokeh.Panel !== undefined)
  }
  if (is_loaded(root)) {
    embed_document(root);
  } else {
    var attempts = 0;
    var timer = setInterval(function(root) {
      if (is_loaded(root)) {
        clearInterval(timer);
        embed_document(root);
      } else if (document.readyState == "complete") {
        attempts++;
        if (attempts > 200) {
          clearInterval(timer);
	  var Bokeh = get_bokeh(root)
	  if (Bokeh == null || Bokeh.Panel == null) {
            console.warn("Panel: ERROR: Unable to run Panel code because Bokeh or Panel library is missing");
	  } else {
	    console.warn("Panel: WARNING: Attempting to render but not all required libraries could be resolved.")
	    embed_document(root)
	  }
        }
      }
    }, 25, root)
  }
})(window);</script>
    <style>
        .bk-notebook-logo {
            display: block;
            width: 20px;
            height: 20px;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAABx0RVh0U29mdHdhcmUAQWRvYmUgRmlyZXdvcmtzIENTNui8sowAAAOkSURBVDiNjZRtaJVlGMd/1/08zzln5zjP1LWcU9N0NkN8m2CYjpgQYQXqSs0I84OLIC0hkEKoPtiH3gmKoiJDU7QpLgoLjLIQCpEsNJ1vqUOdO7ppbuec5+V+rj4ctwzd8IIbbi6u+8f1539dt3A78eXC7QizUF7gyV1fD1Yqg4JWz84yffhm0qkFqBogB9rM8tZdtwVsPUhWhGcFJngGeWrPzHm5oaMmkfEg1usvLFyc8jLRqDOMru7AyC8saQr7GG7f5fvDeH7Ej8CM66nIF+8yngt6HWaKh7k49Soy9nXurCi1o3qUbS3zWfrYeQDTB/Qj6kX6Ybhw4B+bOYoLKCC9H3Nu/leUTZ1JdRWkkn2ldcCamzrcf47KKXdAJllSlxAOkRgyHsGC/zRday5Qld9DyoM4/q/rUoy/CXh3jzOu3bHUVZeU+DEn8FInkPBFlu3+nW3Nw0mk6vCDiWg8CeJaxEwuHS3+z5RgY+YBR6V1Z1nxSOfoaPa4LASWxxdNp+VWTk7+4vzaou8v8PN+xo+KY2xsw6une2frhw05CTYOmQvsEhjhWjn0bmXPjpE1+kplmmkP3suftwTubK9Vq22qKmrBhpY4jvd5afdRA3wGjFAgcnTK2s4hY0/GPNIb0nErGMCRxWOOX64Z8RAC4oCXdklmEvcL8o0BfkNK4lUg9HTl+oPlQxdNo3Mg4Nv175e/1LDGzZen30MEjRUtmXSfiTVu1kK8W4txyV6BMKlbgk3lMwYCiusNy9fVfvvwMxv8Ynl6vxoByANLTWplvuj/nF9m2+PDtt1eiHPBr1oIfhCChQMBw6Aw0UulqTKZdfVvfG7VcfIqLG9bcldL/+pdWTLxLUy8Qq38heUIjh4XlzZxzQm19lLFlr8vdQ97rjZVOLf8nclzckbcD4wxXMidpX30sFd37Fv/GtwwhzhxGVAprjbg0gCAEeIgwCZyTV2Z1REEW8O4py0wsjeloKoMr6iCY6dP92H6Vw/oTyICIthibxjm/DfN9lVz8IqtqKYLUXfoKVMVQVVJOElGjrnnUt9T9wbgp8AyYKaGlqingHZU/uG2NTZSVqwHQTWkx9hxjkpWDaCg6Ckj5qebgBVbT3V3NNXMSiWSDdGV3hrtzla7J+duwPOToIg42ChPQOQjspnSlp1V+Gjdged7+8UN5CRAV7a5EdFNwCjEaBR27b3W890TE7g24NAP/mMDXRWrGoFPQI9ls/MWO2dWFAar/xcOIImbbpA3zgAAAABJRU5ErkJggg==);
        }
    </style>
    <div>
        <a href="https://bokeh.org" target="_blank" class="bk-notebook-logo"></a>
        <span id="e5d4001a-b3c9-44e3-a8f3-9314e588993d">Loading BokehJS ...</span>
    </div>

<script>'use strict';
(function(root) {
  function now() {
    return new Date();
  }

  const force = true;

  if (typeof root._bokeh_onload_callbacks === "undefined" || force === true) {
    root._bokeh_onload_callbacks = [];
    root._bokeh_is_loading = undefined;
  }

const JS_MIME_TYPE = 'application/javascript';
  const HTML_MIME_TYPE = 'text/html';
  const EXEC_MIME_TYPE = 'application/vnd.bokehjs_exec.v0+json';
  const CLASS_NAME = 'output_bokeh rendered_html';

  /**
   * Render data to the DOM node
   */
  function render(props, node) {
    const script = document.createElement("script");
    node.appendChild(script);
  }

  /**
   * Handle when an output is cleared or removed
   */
  function handleClearOutput(event, handle) {
    function drop(id) {
      const view = Bokeh.index.get_by_id(id)
      if (view != null) {
        view.model.document.clear()
        Bokeh.index.delete(view)
      }
    }

    const cell = handle.cell;

    const id = cell.output_area._bokeh_element_id;
    const server_id = cell.output_area._bokeh_server_id;

    // Clean up Bokeh references
    if (id != null) {
      drop(id)
    }

    if (server_id !== undefined) {
      // Clean up Bokeh references
      const cmd_clean = "from bokeh.io.state import curstate; print(curstate().uuid_to_server['" + server_id + "'].get_sessions()[0].document.roots[0]._id)";
      cell.notebook.kernel.execute(cmd_clean, {
        iopub: {
          output: function(msg) {
            const id = msg.content.text.trim()
            drop(id)
          }
        }
      });
      // Destroy server and session
      const cmd_destroy = "import bokeh.io.notebook as ion; ion.destroy_server('" + server_id + "')";
      cell.notebook.kernel.execute(cmd_destroy);
    }
  }

  /**
   * Handle when a new output is added
   */
  function handleAddOutput(event, handle) {
    const output_area = handle.output_area;
    const output = handle.output;

    // limit handleAddOutput to display_data with EXEC_MIME_TYPE content only
    if ((output.output_type != "display_data") || (!Object.prototype.hasOwnProperty.call(output.data, EXEC_MIME_TYPE))) {
      return
    }

    const toinsert = output_area.element.find("." + CLASS_NAME.split(' ')[0]);

    if (output.metadata[EXEC_MIME_TYPE]["id"] !== undefined) {
      toinsert[toinsert.length - 1].firstChild.textContent = output.data[JS_MIME_TYPE];
      // store reference to embed id on output_area
      output_area._bokeh_element_id = output.metadata[EXEC_MIME_TYPE]["id"];
    }
    if (output.metadata[EXEC_MIME_TYPE]["server_id"] !== undefined) {
      const bk_div = document.createElement("div");
      bk_div.innerHTML = output.data[HTML_MIME_TYPE];
      const script_attrs = bk_div.children[0].attributes;
      for (let i = 0; i < script_attrs.length; i++) {
        toinsert[toinsert.length - 1].firstChild.setAttribute(script_attrs[i].name, script_attrs[i].value);
        toinsert[toinsert.length - 1].firstChild.textContent = bk_div.children[0].textContent
      }
      // store reference to server id on output_area
      output_area._bokeh_server_id = output.metadata[EXEC_MIME_TYPE]["server_id"];
    }
  }

  function register_renderer(events, OutputArea) {

    function append_mime(data, metadata, element) {
      // create a DOM node to render to
      const toinsert = this.create_output_subarea(
        metadata,
        CLASS_NAME,
        EXEC_MIME_TYPE
      );
      this.keyboard_manager.register_events(toinsert);
      // Render to node
      const props = {data: data, metadata: metadata[EXEC_MIME_TYPE]};
      render(props, toinsert[toinsert.length - 1]);
      element.append(toinsert);
      return toinsert
    }

    /* Handle when an output is cleared or removed */
    events.on('clear_output.CodeCell', handleClearOutput);
    events.on('delete.Cell', handleClearOutput);

    /* Handle when a new output is added */
    events.on('output_added.OutputArea', handleAddOutput);

    /**
     * Register the mime type and append_mime function with output_area
     */
    OutputArea.prototype.register_mime_type(EXEC_MIME_TYPE, append_mime, {
      /* Is output safe? */
      safe: true,
      /* Index of renderer in `output_area.display_order` */
      index: 0
    });
  }

  // register the mime type if in Jupyter Notebook environment and previously unregistered
  if (root.Jupyter !== undefined) {
    const events = require('base/js/events');
    const OutputArea = require('notebook/js/outputarea').OutputArea;

    if (OutputArea.prototype.mime_types().indexOf(EXEC_MIME_TYPE) == -1) {
      register_renderer(events, OutputArea);
    }
  }
  if (typeof (root._bokeh_timeout) === "undefined" || force === true) {
    root._bokeh_timeout = Date.now() + 5000;
    root._bokeh_failed_load = false;
  }

  const NB_LOAD_WARNING = {'data': {'text/html':
     "<div style='background-color: #fdd'>\n"+
     "<p>\n"+
     "BokehJS does not appear to have successfully loaded. If loading BokehJS from CDN, this \n"+
     "may be due to a slow or bad network connection. Possible fixes:\n"+
     "</p>\n"+
     "<ul>\n"+
     "<li>re-rerun `output_notebook()` to attempt to load from CDN again, or</li>\n"+
     "<li>use INLINE resources instead, as so:</li>\n"+
     "</ul>\n"+
     "<code>\n"+
     "from bokeh.resources import INLINE\n"+
     "output_notebook(resources=INLINE)\n"+
     "</code>\n"+
     "</div>"}};

  function display_loaded(error = null) {
    const el = document.getElementById("e5d4001a-b3c9-44e3-a8f3-9314e588993d");
    if (el != null) {
      const html = (() => {
        if (typeof root.Bokeh === "undefined") {
          if (error == null) {
            return "BokehJS is loading ...";
          } else {
            return "BokehJS failed to load.";
          }
        } else {
          const prefix = `BokehJS ${root.Bokeh.version}`;
          if (error == null) {
            return `${prefix} successfully loaded.`;
          } else {
            return `${prefix} <b>encountered errors</b> while loading and may not function as expected.`;
          }
        }
      })();
      el.innerHTML = html;

      if (error != null) {
        const wrapper = document.createElement("div");
        wrapper.style.overflow = "auto";
        wrapper.style.height = "5em";
        wrapper.style.resize = "vertical";
        const content = document.createElement("div");
        content.style.fontFamily = "monospace";
        content.style.whiteSpace = "pre-wrap";
        content.style.backgroundColor = "rgb(255, 221, 221)";
        content.textContent = error.stack ?? error.toString();
        wrapper.append(content);
        el.append(wrapper);
      }
    } else if (Date.now() < root._bokeh_timeout) {
      setTimeout(() => display_loaded(error), 100);
    }
  }

  function run_callbacks() {
    try {
      root._bokeh_onload_callbacks.forEach(function(callback) {
        if (callback != null)
          callback();
      });
    } finally {
      delete root._bokeh_onload_callbacks
    }
    console.debug("Bokeh: all callbacks have finished");
  }

  function load_libs(css_urls, js_urls, callback) {
    if (css_urls == null) css_urls = [];
    if (js_urls == null) js_urls = [];

    root._bokeh_onload_callbacks.push(callback);
    if (root._bokeh_is_loading > 0) {
      console.debug("Bokeh: BokehJS is being loaded, scheduling callback at", now());
      return null;
    }
    if (js_urls == null || js_urls.length === 0) {
      run_callbacks();
      return null;
    }
    console.debug("Bokeh: BokehJS not loaded, scheduling load and callback at", now());
    root._bokeh_is_loading = css_urls.length + js_urls.length;

    function on_load() {
      root._bokeh_is_loading--;
      if (root._bokeh_is_loading === 0) {
        console.debug("Bokeh: all BokehJS libraries/stylesheets loaded");
        run_callbacks()
      }
    }

    function on_error(url) {
      console.error("failed to load " + url);
    }

    for (let i = 0; i < css_urls.length; i++) {
      const url = css_urls[i];
      const element = document.createElement("link");
      element.onload = on_load;
      element.onerror = on_error.bind(null, url);
      element.rel = "stylesheet";
      element.type = "text/css";
      element.href = url;
      console.debug("Bokeh: injecting link tag for BokehJS stylesheet: ", url);
      document.body.appendChild(element);
    }

    for (let i = 0; i < js_urls.length; i++) {
      const url = js_urls[i];
      const element = document.createElement('script');
      element.onload = on_load;
      element.onerror = on_error.bind(null, url);
      element.async = false;
      element.src = url;
      console.debug("Bokeh: injecting script tag for BokehJS library: ", url);
      document.head.appendChild(element);
    }
  };

  function inject_raw_css(css) {
    const element = document.createElement("style");
    element.appendChild(document.createTextNode(css));
    document.body.appendChild(element);
  }

  const js_urls = ["https://cdn.holoviz.org/panel/1.5.3/dist/bundled/reactiveesm/es-module-shims@^1.10.0/dist/es-module-shims.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-3.6.0.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-gl-3.6.0.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-widgets-3.6.0.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-tables-3.6.0.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-mathjax-3.6.0.min.js", "https://unpkg.com/@holoviz/panel@1.5.3/dist/panel.min.js"];
  const css_urls = [];

  const inline_js = [    function(Bokeh) {
      Bokeh.set_log_level("info");
    },
function(Bokeh) {
    }
  ];

  function run_inline_js() {
    if (root.Bokeh !== undefined || force === true) {
      try {
            for (let i = 0; i < inline_js.length; i++) {
      inline_js[i].call(root, root.Bokeh);
    }

      } catch (error) {display_loaded(error);throw error;
      }if (force === true) {
        display_loaded();
      }} else if (Date.now() < root._bokeh_timeout) {
      setTimeout(run_inline_js, 100);
    } else if (!root._bokeh_failed_load) {
      console.log("Bokeh: BokehJS failed to load within specified timeout.");
      root._bokeh_failed_load = true;
    } else if (force !== true) {
      const cell = $(document.getElementById("e5d4001a-b3c9-44e3-a8f3-9314e588993d")).parents('.cell').data().cell;
      cell.output_area.append_execute_result(NB_LOAD_WARNING)
    }
  }

  if (root._bokeh_is_loading === 0) {
    console.debug("Bokeh: BokehJS loaded, going straight to plotting");
    run_inline_js();
  } else {
    load_libs(css_urls, js_urls, function() {
      console.debug("Bokeh: BokehJS plotting callback run at", now());
      run_inline_js();
    });
  }
}(window));</script>
    <style>
        .bk-notebook-logo {
            display: block;
            width: 20px;
            height: 20px;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAABx0RVh0U29mdHdhcmUAQWRvYmUgRmlyZXdvcmtzIENTNui8sowAAAOkSURBVDiNjZRtaJVlGMd/1/08zzln5zjP1LWcU9N0NkN8m2CYjpgQYQXqSs0I84OLIC0hkEKoPtiH3gmKoiJDU7QpLgoLjLIQCpEsNJ1vqUOdO7ppbuec5+V+rj4ctwzd8IIbbi6u+8f1539dt3A78eXC7QizUF7gyV1fD1Yqg4JWz84yffhm0qkFqBogB9rM8tZdtwVsPUhWhGcFJngGeWrPzHm5oaMmkfEg1usvLFyc8jLRqDOMru7AyC8saQr7GG7f5fvDeH7Ej8CM66nIF+8yngt6HWaKh7k49Soy9nXurCi1o3qUbS3zWfrYeQDTB/Qj6kX6Ybhw4B+bOYoLKCC9H3Nu/leUTZ1JdRWkkn2ldcCamzrcf47KKXdAJllSlxAOkRgyHsGC/zRday5Qld9DyoM4/q/rUoy/CXh3jzOu3bHUVZeU+DEn8FInkPBFlu3+nW3Nw0mk6vCDiWg8CeJaxEwuHS3+z5RgY+YBR6V1Z1nxSOfoaPa4LASWxxdNp+VWTk7+4vzaou8v8PN+xo+KY2xsw6une2frhw05CTYOmQvsEhjhWjn0bmXPjpE1+kplmmkP3suftwTubK9Vq22qKmrBhpY4jvd5afdRA3wGjFAgcnTK2s4hY0/GPNIb0nErGMCRxWOOX64Z8RAC4oCXdklmEvcL8o0BfkNK4lUg9HTl+oPlQxdNo3Mg4Nv175e/1LDGzZen30MEjRUtmXSfiTVu1kK8W4txyV6BMKlbgk3lMwYCiusNy9fVfvvwMxv8Ynl6vxoByANLTWplvuj/nF9m2+PDtt1eiHPBr1oIfhCChQMBw6Aw0UulqTKZdfVvfG7VcfIqLG9bcldL/+pdWTLxLUy8Qq38heUIjh4XlzZxzQm19lLFlr8vdQ97rjZVOLf8nclzckbcD4wxXMidpX30sFd37Fv/GtwwhzhxGVAprjbg0gCAEeIgwCZyTV2Z1REEW8O4py0wsjeloKoMr6iCY6dP92H6Vw/oTyICIthibxjm/DfN9lVz8IqtqKYLUXfoKVMVQVVJOElGjrnnUt9T9wbgp8AyYKaGlqingHZU/uG2NTZSVqwHQTWkx9hxjkpWDaCg6Ckj5qebgBVbT3V3NNXMSiWSDdGV3hrtzla7J+duwPOToIg42ChPQOQjspnSlp1V+Gjdged7+8UN5CRAV7a5EdFNwCjEaBR27b3W890TE7g24NAP/mMDXRWrGoFPQI9ls/MWO2dWFAar/xcOIImbbpA3zgAAAABJRU5ErkJggg==);
        }
    </style>
    <div>
        <a href="https://bokeh.org" target="_blank" class="bk-notebook-logo"></a>
        <span id="a7dfa234-3e54-4cc1-abe4-06578954f528">Loading BokehJS ...</span>
    </div>

<script>'use strict';
(function(root) {
  function now() {
    return new Date();
  }

  const force = true;

  if (typeof root._bokeh_onload_callbacks === "undefined" || force === true) {
    root._bokeh_onload_callbacks = [];
    root._bokeh_is_loading = undefined;
  }

const JS_MIME_TYPE = 'application/javascript';
  const HTML_MIME_TYPE = 'text/html';
  const EXEC_MIME_TYPE = 'application/vnd.bokehjs_exec.v0+json';
  const CLASS_NAME = 'output_bokeh rendered_html';

  /**
   * Render data to the DOM node
   */
  function render(props, node) {
    const script = document.createElement("script");
    node.appendChild(script);
  }

  /**
   * Handle when an output is cleared or removed
   */
  function handleClearOutput(event, handle) {
    function drop(id) {
      const view = Bokeh.index.get_by_id(id)
      if (view != null) {
        view.model.document.clear()
        Bokeh.index.delete(view)
      }
    }

    const cell = handle.cell;

    const id = cell.output_area._bokeh_element_id;
    const server_id = cell.output_area._bokeh_server_id;

    // Clean up Bokeh references
    if (id != null) {
      drop(id)
    }

    if (server_id !== undefined) {
      // Clean up Bokeh references
      const cmd_clean = "from bokeh.io.state import curstate; print(curstate().uuid_to_server['" + server_id + "'].get_sessions()[0].document.roots[0]._id)";
      cell.notebook.kernel.execute(cmd_clean, {
        iopub: {
          output: function(msg) {
            const id = msg.content.text.trim()
            drop(id)
          }
        }
      });
      // Destroy server and session
      const cmd_destroy = "import bokeh.io.notebook as ion; ion.destroy_server('" + server_id + "')";
      cell.notebook.kernel.execute(cmd_destroy);
    }
  }

  /**
   * Handle when a new output is added
   */
  function handleAddOutput(event, handle) {
    const output_area = handle.output_area;
    const output = handle.output;

    // limit handleAddOutput to display_data with EXEC_MIME_TYPE content only
    if ((output.output_type != "display_data") || (!Object.prototype.hasOwnProperty.call(output.data, EXEC_MIME_TYPE))) {
      return
    }

    const toinsert = output_area.element.find("." + CLASS_NAME.split(' ')[0]);

    if (output.metadata[EXEC_MIME_TYPE]["id"] !== undefined) {
      toinsert[toinsert.length - 1].firstChild.textContent = output.data[JS_MIME_TYPE];
      // store reference to embed id on output_area
      output_area._bokeh_element_id = output.metadata[EXEC_MIME_TYPE]["id"];
    }
    if (output.metadata[EXEC_MIME_TYPE]["server_id"] !== undefined) {
      const bk_div = document.createElement("div");
      bk_div.innerHTML = output.data[HTML_MIME_TYPE];
      const script_attrs = bk_div.children[0].attributes;
      for (let i = 0; i < script_attrs.length; i++) {
        toinsert[toinsert.length - 1].firstChild.setAttribute(script_attrs[i].name, script_attrs[i].value);
        toinsert[toinsert.length - 1].firstChild.textContent = bk_div.children[0].textContent
      }
      // store reference to server id on output_area
      output_area._bokeh_server_id = output.metadata[EXEC_MIME_TYPE]["server_id"];
    }
  }

  function register_renderer(events, OutputArea) {

    function append_mime(data, metadata, element) {
      // create a DOM node to render to
      const toinsert = this.create_output_subarea(
        metadata,
        CLASS_NAME,
        EXEC_MIME_TYPE
      );
      this.keyboard_manager.register_events(toinsert);
      // Render to node
      const props = {data: data, metadata: metadata[EXEC_MIME_TYPE]};
      render(props, toinsert[toinsert.length - 1]);
      element.append(toinsert);
      return toinsert
    }

    /* Handle when an output is cleared or removed */
    events.on('clear_output.CodeCell', handleClearOutput);
    events.on('delete.Cell', handleClearOutput);

    /* Handle when a new output is added */
    events.on('output_added.OutputArea', handleAddOutput);

    /**
     * Register the mime type and append_mime function with output_area
     */
    OutputArea.prototype.register_mime_type(EXEC_MIME_TYPE, append_mime, {
      /* Is output safe? */
      safe: true,
      /* Index of renderer in `output_area.display_order` */
      index: 0
    });
  }

  // register the mime type if in Jupyter Notebook environment and previously unregistered
  if (root.Jupyter !== undefined) {
    const events = require('base/js/events');
    const OutputArea = require('notebook/js/outputarea').OutputArea;

    if (OutputArea.prototype.mime_types().indexOf(EXEC_MIME_TYPE) == -1) {
      register_renderer(events, OutputArea);
    }
  }
  if (typeof (root._bokeh_timeout) === "undefined" || force === true) {
    root._bokeh_timeout = Date.now() + 5000;
    root._bokeh_failed_load = false;
  }

  const NB_LOAD_WARNING = {'data': {'text/html':
     "<div style='background-color: #fdd'>\n"+
     "<p>\n"+
     "BokehJS does not appear to have successfully loaded. If loading BokehJS from CDN, this \n"+
     "may be due to a slow or bad network connection. Possible fixes:\n"+
     "</p>\n"+
     "<ul>\n"+
     "<li>re-rerun `output_notebook()` to attempt to load from CDN again, or</li>\n"+
     "<li>use INLINE resources instead, as so:</li>\n"+
     "</ul>\n"+
     "<code>\n"+
     "from bokeh.resources import INLINE\n"+
     "output_notebook(resources=INLINE)\n"+
     "</code>\n"+
     "</div>"}};

  function display_loaded(error = null) {
    const el = document.getElementById("a7dfa234-3e54-4cc1-abe4-06578954f528");
    if (el != null) {
      const html = (() => {
        if (typeof root.Bokeh === "undefined") {
          if (error == null) {
            return "BokehJS is loading ...";
          } else {
            return "BokehJS failed to load.";
          }
        } else {
          const prefix = `BokehJS ${root.Bokeh.version}`;
          if (error == null) {
            return `${prefix} successfully loaded.`;
          } else {
            return `${prefix} <b>encountered errors</b> while loading and may not function as expected.`;
          }
        }
      })();
      el.innerHTML = html;

      if (error != null) {
        const wrapper = document.createElement("div");
        wrapper.style.overflow = "auto";
        wrapper.style.height = "5em";
        wrapper.style.resize = "vertical";
        const content = document.createElement("div");
        content.style.fontFamily = "monospace";
        content.style.whiteSpace = "pre-wrap";
        content.style.backgroundColor = "rgb(255, 221, 221)";
        content.textContent = error.stack ?? error.toString();
        wrapper.append(content);
        el.append(wrapper);
      }
    } else if (Date.now() < root._bokeh_timeout) {
      setTimeout(() => display_loaded(error), 100);
    }
  }

  function run_callbacks() {
    try {
      root._bokeh_onload_callbacks.forEach(function(callback) {
        if (callback != null)
          callback();
      });
    } finally {
      delete root._bokeh_onload_callbacks
    }
    console.debug("Bokeh: all callbacks have finished");
  }

  function load_libs(css_urls, js_urls, callback) {
    if (css_urls == null) css_urls = [];
    if (js_urls == null) js_urls = [];

    root._bokeh_onload_callbacks.push(callback);
    if (root._bokeh_is_loading > 0) {
      console.debug("Bokeh: BokehJS is being loaded, scheduling callback at", now());
      return null;
    }
    if (js_urls == null || js_urls.length === 0) {
      run_callbacks();
      return null;
    }
    console.debug("Bokeh: BokehJS not loaded, scheduling load and callback at", now());
    root._bokeh_is_loading = css_urls.length + js_urls.length;

    function on_load() {
      root._bokeh_is_loading--;
      if (root._bokeh_is_loading === 0) {
        console.debug("Bokeh: all BokehJS libraries/stylesheets loaded");
        run_callbacks()
      }
    }

    function on_error(url) {
      console.error("failed to load " + url);
    }

    for (let i = 0; i < css_urls.length; i++) {
      const url = css_urls[i];
      const element = document.createElement("link");
      element.onload = on_load;
      element.onerror = on_error.bind(null, url);
      element.rel = "stylesheet";
      element.type = "text/css";
      element.href = url;
      console.debug("Bokeh: injecting link tag for BokehJS stylesheet: ", url);
      document.body.appendChild(element);
    }

    for (let i = 0; i < js_urls.length; i++) {
      const url = js_urls[i];
      const element = document.createElement('script');
      element.onload = on_load;
      element.onerror = on_error.bind(null, url);
      element.async = false;
      element.src = url;
      console.debug("Bokeh: injecting script tag for BokehJS library: ", url);
      document.head.appendChild(element);
    }
  };

  function inject_raw_css(css) {
    const element = document.createElement("style");
    element.appendChild(document.createTextNode(css));
    document.body.appendChild(element);
  }

  const js_urls = ["https://cdn.holoviz.org/panel/1.5.3/dist/bundled/reactiveesm/es-module-shims@^1.10.0/dist/es-module-shims.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-3.6.0.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-gl-3.6.0.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-widgets-3.6.0.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-tables-3.6.0.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-mathjax-3.6.0.min.js", "https://unpkg.com/@holoviz/panel@1.5.3/dist/panel.min.js"];
  const css_urls = [];

  const inline_js = [    function(Bokeh) {
      Bokeh.set_log_level("info");
    },
function(Bokeh) {
    }
  ];

  function run_inline_js() {
    if (root.Bokeh !== undefined || force === true) {
      try {
            for (let i = 0; i < inline_js.length; i++) {
      inline_js[i].call(root, root.Bokeh);
    }

      } catch (error) {display_loaded(error);throw error;
      }if (force === true) {
        display_loaded();
      }} else if (Date.now() < root._bokeh_timeout) {
      setTimeout(run_inline_js, 100);
    } else if (!root._bokeh_failed_load) {
      console.log("Bokeh: BokehJS failed to load within specified timeout.");
      root._bokeh_failed_load = true;
    } else if (force !== true) {
      const cell = $(document.getElementById("a7dfa234-3e54-4cc1-abe4-06578954f528")).parents('.cell').data().cell;
      cell.output_area.append_execute_result(NB_LOAD_WARNING)
    }
  }

  if (root._bokeh_is_loading === 0) {
    console.debug("Bokeh: BokehJS loaded, going straight to plotting");
    run_inline_js();
  } else {
    load_libs(css_urls, js_urls, function() {
      console.debug("Bokeh: BokehJS plotting callback run at", now());
      run_inline_js();
    });
  }
}(window));</script>
    <style>
        .bk-notebook-logo {
            display: block;
            width: 20px;
            height: 20px;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAABx0RVh0U29mdHdhcmUAQWRvYmUgRmlyZXdvcmtzIENTNui8sowAAAOkSURBVDiNjZRtaJVlGMd/1/08zzln5zjP1LWcU9N0NkN8m2CYjpgQYQXqSs0I84OLIC0hkEKoPtiH3gmKoiJDU7QpLgoLjLIQCpEsNJ1vqUOdO7ppbuec5+V+rj4ctwzd8IIbbi6u+8f1539dt3A78eXC7QizUF7gyV1fD1Yqg4JWz84yffhm0qkFqBogB9rM8tZdtwVsPUhWhGcFJngGeWrPzHm5oaMmkfEg1usvLFyc8jLRqDOMru7AyC8saQr7GG7f5fvDeH7Ej8CM66nIF+8yngt6HWaKh7k49Soy9nXurCi1o3qUbS3zWfrYeQDTB/Qj6kX6Ybhw4B+bOYoLKCC9H3Nu/leUTZ1JdRWkkn2ldcCamzrcf47KKXdAJllSlxAOkRgyHsGC/zRday5Qld9DyoM4/q/rUoy/CXh3jzOu3bHUVZeU+DEn8FInkPBFlu3+nW3Nw0mk6vCDiWg8CeJaxEwuHS3+z5RgY+YBR6V1Z1nxSOfoaPa4LASWxxdNp+VWTk7+4vzaou8v8PN+xo+KY2xsw6une2frhw05CTYOmQvsEhjhWjn0bmXPjpE1+kplmmkP3suftwTubK9Vq22qKmrBhpY4jvd5afdRA3wGjFAgcnTK2s4hY0/GPNIb0nErGMCRxWOOX64Z8RAC4oCXdklmEvcL8o0BfkNK4lUg9HTl+oPlQxdNo3Mg4Nv175e/1LDGzZen30MEjRUtmXSfiTVu1kK8W4txyV6BMKlbgk3lMwYCiusNy9fVfvvwMxv8Ynl6vxoByANLTWplvuj/nF9m2+PDtt1eiHPBr1oIfhCChQMBw6Aw0UulqTKZdfVvfG7VcfIqLG9bcldL/+pdWTLxLUy8Qq38heUIjh4XlzZxzQm19lLFlr8vdQ97rjZVOLf8nclzckbcD4wxXMidpX30sFd37Fv/GtwwhzhxGVAprjbg0gCAEeIgwCZyTV2Z1REEW8O4py0wsjeloKoMr6iCY6dP92H6Vw/oTyICIthibxjm/DfN9lVz8IqtqKYLUXfoKVMVQVVJOElGjrnnUt9T9wbgp8AyYKaGlqingHZU/uG2NTZSVqwHQTWkx9hxjkpWDaCg6Ckj5qebgBVbT3V3NNXMSiWSDdGV3hrtzla7J+duwPOToIg42ChPQOQjspnSlp1V+Gjdged7+8UN5CRAV7a5EdFNwCjEaBR27b3W890TE7g24NAP/mMDXRWrGoFPQI9ls/MWO2dWFAar/xcOIImbbpA3zgAAAABJRU5ErkJggg==);
        }
    </style>
    <div>
        <a href="https://bokeh.org" target="_blank" class="bk-notebook-logo"></a>
        <span id="cfa569a9-b390-41c2-9349-f71b9380cd6f">Loading BokehJS ...</span>
    </div>

<script>'use strict';
(function(root) {
  function now() {
    return new Date();
  }

  const force = true;

  if (typeof root._bokeh_onload_callbacks === "undefined" || force === true) {
    root._bokeh_onload_callbacks = [];
    root._bokeh_is_loading = undefined;
  }

const JS_MIME_TYPE = 'application/javascript';
  const HTML_MIME_TYPE = 'text/html';
  const EXEC_MIME_TYPE = 'application/vnd.bokehjs_exec.v0+json';
  const CLASS_NAME = 'output_bokeh rendered_html';

  /**
   * Render data to the DOM node
   */
  function render(props, node) {
    const script = document.createElement("script");
    node.appendChild(script);
  }

  /**
   * Handle when an output is cleared or removed
   */
  function handleClearOutput(event, handle) {
    function drop(id) {
      const view = Bokeh.index.get_by_id(id)
      if (view != null) {
        view.model.document.clear()
        Bokeh.index.delete(view)
      }
    }

    const cell = handle.cell;

    const id = cell.output_area._bokeh_element_id;
    const server_id = cell.output_area._bokeh_server_id;

    // Clean up Bokeh references
    if (id != null) {
      drop(id)
    }

    if (server_id !== undefined) {
      // Clean up Bokeh references
      const cmd_clean = "from bokeh.io.state import curstate; print(curstate().uuid_to_server['" + server_id + "'].get_sessions()[0].document.roots[0]._id)";
      cell.notebook.kernel.execute(cmd_clean, {
        iopub: {
          output: function(msg) {
            const id = msg.content.text.trim()
            drop(id)
          }
        }
      });
      // Destroy server and session
      const cmd_destroy = "import bokeh.io.notebook as ion; ion.destroy_server('" + server_id + "')";
      cell.notebook.kernel.execute(cmd_destroy);
    }
  }

  /**
   * Handle when a new output is added
   */
  function handleAddOutput(event, handle) {
    const output_area = handle.output_area;
    const output = handle.output;

    // limit handleAddOutput to display_data with EXEC_MIME_TYPE content only
    if ((output.output_type != "display_data") || (!Object.prototype.hasOwnProperty.call(output.data, EXEC_MIME_TYPE))) {
      return
    }

    const toinsert = output_area.element.find("." + CLASS_NAME.split(' ')[0]);

    if (output.metadata[EXEC_MIME_TYPE]["id"] !== undefined) {
      toinsert[toinsert.length - 1].firstChild.textContent = output.data[JS_MIME_TYPE];
      // store reference to embed id on output_area
      output_area._bokeh_element_id = output.metadata[EXEC_MIME_TYPE]["id"];
    }
    if (output.metadata[EXEC_MIME_TYPE]["server_id"] !== undefined) {
      const bk_div = document.createElement("div");
      bk_div.innerHTML = output.data[HTML_MIME_TYPE];
      const script_attrs = bk_div.children[0].attributes;
      for (let i = 0; i < script_attrs.length; i++) {
        toinsert[toinsert.length - 1].firstChild.setAttribute(script_attrs[i].name, script_attrs[i].value);
        toinsert[toinsert.length - 1].firstChild.textContent = bk_div.children[0].textContent
      }
      // store reference to server id on output_area
      output_area._bokeh_server_id = output.metadata[EXEC_MIME_TYPE]["server_id"];
    }
  }

  function register_renderer(events, OutputArea) {

    function append_mime(data, metadata, element) {
      // create a DOM node to render to
      const toinsert = this.create_output_subarea(
        metadata,
        CLASS_NAME,
        EXEC_MIME_TYPE
      );
      this.keyboard_manager.register_events(toinsert);
      // Render to node
      const props = {data: data, metadata: metadata[EXEC_MIME_TYPE]};
      render(props, toinsert[toinsert.length - 1]);
      element.append(toinsert);
      return toinsert
    }

    /* Handle when an output is cleared or removed */
    events.on('clear_output.CodeCell', handleClearOutput);
    events.on('delete.Cell', handleClearOutput);

    /* Handle when a new output is added */
    events.on('output_added.OutputArea', handleAddOutput);

    /**
     * Register the mime type and append_mime function with output_area
     */
    OutputArea.prototype.register_mime_type(EXEC_MIME_TYPE, append_mime, {
      /* Is output safe? */
      safe: true,
      /* Index of renderer in `output_area.display_order` */
      index: 0
    });
  }

  // register the mime type if in Jupyter Notebook environment and previously unregistered
  if (root.Jupyter !== undefined) {
    const events = require('base/js/events');
    const OutputArea = require('notebook/js/outputarea').OutputArea;

    if (OutputArea.prototype.mime_types().indexOf(EXEC_MIME_TYPE) == -1) {
      register_renderer(events, OutputArea);
    }
  }
  if (typeof (root._bokeh_timeout) === "undefined" || force === true) {
    root._bokeh_timeout = Date.now() + 5000;
    root._bokeh_failed_load = false;
  }

  const NB_LOAD_WARNING = {'data': {'text/html':
     "<div style='background-color: #fdd'>\n"+
     "<p>\n"+
     "BokehJS does not appear to have successfully loaded. If loading BokehJS from CDN, this \n"+
     "may be due to a slow or bad network connection. Possible fixes:\n"+
     "</p>\n"+
     "<ul>\n"+
     "<li>re-rerun `output_notebook()` to attempt to load from CDN again, or</li>\n"+
     "<li>use INLINE resources instead, as so:</li>\n"+
     "</ul>\n"+
     "<code>\n"+
     "from bokeh.resources import INLINE\n"+
     "output_notebook(resources=INLINE)\n"+
     "</code>\n"+
     "</div>"}};

  function display_loaded(error = null) {
    const el = document.getElementById("cfa569a9-b390-41c2-9349-f71b9380cd6f");
    if (el != null) {
      const html = (() => {
        if (typeof root.Bokeh === "undefined") {
          if (error == null) {
            return "BokehJS is loading ...";
          } else {
            return "BokehJS failed to load.";
          }
        } else {
          const prefix = `BokehJS ${root.Bokeh.version}`;
          if (error == null) {
            return `${prefix} successfully loaded.`;
          } else {
            return `${prefix} <b>encountered errors</b> while loading and may not function as expected.`;
          }
        }
      })();
      el.innerHTML = html;

      if (error != null) {
        const wrapper = document.createElement("div");
        wrapper.style.overflow = "auto";
        wrapper.style.height = "5em";
        wrapper.style.resize = "vertical";
        const content = document.createElement("div");
        content.style.fontFamily = "monospace";
        content.style.whiteSpace = "pre-wrap";
        content.style.backgroundColor = "rgb(255, 221, 221)";
        content.textContent = error.stack ?? error.toString();
        wrapper.append(content);
        el.append(wrapper);
      }
    } else if (Date.now() < root._bokeh_timeout) {
      setTimeout(() => display_loaded(error), 100);
    }
  }

  function run_callbacks() {
    try {
      root._bokeh_onload_callbacks.forEach(function(callback) {
        if (callback != null)
          callback();
      });
    } finally {
      delete root._bokeh_onload_callbacks
    }
    console.debug("Bokeh: all callbacks have finished");
  }

  function load_libs(css_urls, js_urls, callback) {
    if (css_urls == null) css_urls = [];
    if (js_urls == null) js_urls = [];

    root._bokeh_onload_callbacks.push(callback);
    if (root._bokeh_is_loading > 0) {
      console.debug("Bokeh: BokehJS is being loaded, scheduling callback at", now());
      return null;
    }
    if (js_urls == null || js_urls.length === 0) {
      run_callbacks();
      return null;
    }
    console.debug("Bokeh: BokehJS not loaded, scheduling load and callback at", now());
    root._bokeh_is_loading = css_urls.length + js_urls.length;

    function on_load() {
      root._bokeh_is_loading--;
      if (root._bokeh_is_loading === 0) {
        console.debug("Bokeh: all BokehJS libraries/stylesheets loaded");
        run_callbacks()
      }
    }

    function on_error(url) {
      console.error("failed to load " + url);
    }

    for (let i = 0; i < css_urls.length; i++) {
      const url = css_urls[i];
      const element = document.createElement("link");
      element.onload = on_load;
      element.onerror = on_error.bind(null, url);
      element.rel = "stylesheet";
      element.type = "text/css";
      element.href = url;
      console.debug("Bokeh: injecting link tag for BokehJS stylesheet: ", url);
      document.body.appendChild(element);
    }

    for (let i = 0; i < js_urls.length; i++) {
      const url = js_urls[i];
      const element = document.createElement('script');
      element.onload = on_load;
      element.onerror = on_error.bind(null, url);
      element.async = false;
      element.src = url;
      console.debug("Bokeh: injecting script tag for BokehJS library: ", url);
      document.head.appendChild(element);
    }
  };

  function inject_raw_css(css) {
    const element = document.createElement("style");
    element.appendChild(document.createTextNode(css));
    document.body.appendChild(element);
  }

  const js_urls = ["https://cdn.holoviz.org/panel/1.5.3/dist/bundled/reactiveesm/es-module-shims@^1.10.0/dist/es-module-shims.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-3.6.0.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-gl-3.6.0.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-widgets-3.6.0.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-tables-3.6.0.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-mathjax-3.6.0.min.js", "https://unpkg.com/@holoviz/panel@1.5.3/dist/panel.min.js"];
  const css_urls = [];

  const inline_js = [    function(Bokeh) {
      Bokeh.set_log_level("info");
    },
function(Bokeh) {
    }
  ];

  function run_inline_js() {
    if (root.Bokeh !== undefined || force === true) {
      try {
            for (let i = 0; i < inline_js.length; i++) {
      inline_js[i].call(root, root.Bokeh);
    }

      } catch (error) {display_loaded(error);throw error;
      }if (force === true) {
        display_loaded();
      }} else if (Date.now() < root._bokeh_timeout) {
      setTimeout(run_inline_js, 100);
    } else if (!root._bokeh_failed_load) {
      console.log("Bokeh: BokehJS failed to load within specified timeout.");
      root._bokeh_failed_load = true;
    } else if (force !== true) {
      const cell = $(document.getElementById("cfa569a9-b390-41c2-9349-f71b9380cd6f")).parents('.cell').data().cell;
      cell.output_area.append_execute_result(NB_LOAD_WARNING)
    }
  }

  if (root._bokeh_is_loading === 0) {
    console.debug("Bokeh: BokehJS loaded, going straight to plotting");
    run_inline_js();
  } else {
    load_libs(css_urls, js_urls, function() {
      console.debug("Bokeh: BokehJS plotting callback run at", now());
      run_inline_js();
    });
  }
}(window));</script>
<div class="highlight"><pre>
&lt;panel.io.server.Server at 0x16f599520&gt;
</pre></div>

    <HR/>
    <div class="footer">
      <p>Published from <a href="st5442_assignment4.py">st5442_assignment4.py</a>
    using <a href="http://mpastell.com/pweave">Pweave</a> 0.30.3
    on 08-02-2025.<p></div>

            </div>
        </div>
    </div>
  </BODY>
</HTML>
